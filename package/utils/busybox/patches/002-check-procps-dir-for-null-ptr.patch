--- a/libbb/procps.c	2025-02-27 10:59:37.934842566 +0200
+++ b/libbb/procps.c	2025-02-27 10:59:49.719542380 +0200
@@ -302,6 +302,10 @@
 			sp->task_dir = NULL;
 		}
 #endif
+		if (!sp->dir) {
+			free_procps_scan(sp);
+			return NULL;
+		}
 		entry = readdir(sp->dir);
 		if (entry == NULL) {
 			free_procps_scan(sp);
