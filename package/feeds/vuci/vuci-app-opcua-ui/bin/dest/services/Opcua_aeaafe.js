(function(_,E){typeof exports=="object"&&typeof module<"u"?module.exports=E():typeof define=="function"&&define.amd?define(E):(_=typeof globalThis<"u"?globalThis:_||self,_["services/Opcua_js"]=E())})(this,function(){"use strict";function _(t,e,r,i,n,o,a,l){var s=typeof t=="function"?t.options:t;e&&(s.render=e,s.staticRenderFns=r,s._compiled=!0),i&&(s.functional=!0),o&&(s._scopeId="data-v-"+o);var d;if(a?(d=function(f){f=f||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!f&&typeof __VUE_SSR_CONTEXT__<"u"&&(f=__VUE_SSR_CONTEXT__),n&&n.call(this,f),f&&f._registeredComponents&&f._registeredComponents.add(a)},s._ssrRegister=d):n&&(d=l?function(){n.call(this,(s.functional?this.parent:this).$root.$options.shadowRoot)}:n),d)if(s.functional){s._injectStyles=d;var u=s.render;s.render=function(p,O){return d.call(O),u(p,O)}}else{var c=s.beforeCreate;s.beforeCreate=c?[].concat(c,d):[d]}return{exports:t,options:s}}const E={props:{section:{type:Object,required:!0}},data(){return{formData:{},idTypeOptions:[["0",this.$t("Numeric")],["1",this.$t("String")],["2",this.$t("GUID")],["3",this.$t("Bytestring")]]}},methods:{getIDRule(t){return{0:"range(0,4294967295)",1:"string",2:"guid",3:"base64"}[parseInt(t.type,10)]},nodeExistsInServer(t){return this.formData.serverNodes.filter(e=>e[".type"]===this.section[".type"]&&e.name===t).length>1?{isValid:!1,message:this.$t("Instance '%s' already exists").format(t)}:{isValid:!0}},updateValidations(t){t.vuciSection.validate()}}};var F=function(){var e=this,r=e._self._c;return r("vuci-form",{attrs:{config:"opcua_client",editing:""},scopedSlots:e._u([{key:"default",fn:function({uciData:i}){return[r("vuci-named-section",{attrs:{"uci-data":i,name:e.section.id,title:e.$t("OPC UA server node configuration"),"data-key":"serverNodes",endpoints:[{endpoint:`opcua/server/${e.section[".type"].split("_")[2]}/nodes/config`}]},scopedSlots:e._u([{key:"default",fn:function({s:n}){return[r("vuci-form-item-input",{attrs:{"uci-section":n,name:"name",label:e.$t("Name"),help:e.$t("Name of the server node."),rules:["uciname",o=>e.nodeExistsInServer(o)],required:""}}),r("vuci-form-item-input",{attrs:{"uci-section":n,name:"ns",label:e.$t("ID namespace"),help:e.$t("Node ID namespace."),rules:"irange(0,65535)",placeholder:"1",required:""}}),r("vuci-form-item-select",{attrs:{"uci-section":n,name:"type",label:e.$t("ID type"),help:e.$t("Node ID type."),required:"",options:e.idTypeOptions},on:{change:e.updateValidations}}),r("vuci-form-item-input",{attrs:{"uci-section":n,name:"node_id",label:e.$t("ID"),help:e.$t("Node ID."),rules:e.getIDRule(n),required:""}})]}}],null,!0)})]}}]),model:{value:e.formData,callback:function(i){e.formData=i},expression:"formData"}})},H=[],W=_(E,F,H,!1,null,null,null,null);const X=W.exports,z={props:{getData:{type:Function,required:!0},endpoint:{type:String,required:!0},uciSection:{type:Object,required:!0},showResponse:{type:Boolean,default:!1}},data(){return{isRunning:!1,response:"",openResponse:!1,errors:{1:this.$t("An unexpected error occurred"),2:this.$t("Test failed"),103:this.$t("Tested section has invalid fields")}}},methods:{async test(t){const e=this.getData(t.uciSection);return this.isRunning=!0,this.$axios.post(this.endpoint,{data:e}).then(({data:r})=>{this.$message.success(this.$t("Test is successful")),this.response=r.response,this.openResponse=!0}).catch(r=>{const i=r.response.data.errors[0],n=this.errors[i.code]||this.$t("An unexpected error occurred");this.$message.error(n)}).finally(()=>{this.isRunning=!1})}}};var B=function(){var e=this,r=e._self._c;return r("div",[r("vuci-form-item-button",{attrs:{"uci-section":e.uciSection,name:"test",text:e.$t("Test"),readonly:e.isRunning},on:{click:e.test}}),e.showResponse&&e.openResponse?r("tlt-modal",{on:{close:function(i){e.openResponse=!1}}},[r("tlt-card",{attrs:{title:e.$t("Test response")}},[r("tlt-text-area",{attrs:{"custom-id":"test-output",rows:"39",readonly:""},model:{value:e.response,callback:function(i){e.response=i},expression:"response"}})],1)],1):e._e()],1)},J=[],K=_(z,B,J,!1,null,null,null,null);const S=K.exports,C=50,Z={components:{OpcuaTest:S},props:{section:{type:Object,required:!0}},data(){return{editServerNodeModal:X,serverNodeColumns:[{name:"name",label:this.$t("Server node name")},{name:"test",label:this.$t("Test node")}],formData:{}}},computed:{sectionServerNodes(){return this.formData.serverNodes.filter(t=>t[".type"]===`server_node_${this.section.id}`)}},methods:{validateOpcUrl(t){const e=["http","https","opc.tcp"],r=t.match(/^(http[s]?|opc.tcp):\/\/[a-zA-Z0-9]{1,63}(:([0-9]+))([/?][^\s]*)*$/);return r?(this.$VuciValidator.value=r[3],this.$VuciValidator.port()):(this.$VuciValidator.value=t,this.$VuciValidator.protourl(e))},onServerNodeDelete(t,e){e.groupValue=e.groupValue.map(r=>({...r,enabled:r.server_node===t.id?"0":r.enabled})),e.serverNodes=e.serverNodes.filter(r=>r[".type"]!==`server_node_${t.id}`)},serverNodeExists(t){return{isValid:!this.sectionServerNodes.some(e=>e.name===t),message:this.$t("Instance '%s' already exists").format(t)}},serverExists(t){return{isValid:this.formData.server.filter(e=>e.name===t).length<=1,message:this.$t("Instance '%s' already exists").format(t)}},getServerNodeTestData(t){return{node_id:t.node_id,type:t.type,ns:t.ns}},nodeLimit(){return{isValid:this.sectionServerNodes.length<C,message:this.$t("Server node limit was reached (%s max)").format(C)}}}};var Q=function(){var e=this,r=e._self._c;return r("vuci-form",{attrs:{config:"opcua_client",editing:""},scopedSlots:e._u([{key:"default",fn:function({uciData:i}){return[r("vuci-named-section",{attrs:{name:e.section.id,"uci-data":i,title:e.$t("OPC UA server configuration"),"data-key":"server",endpoints:[{endpoint:"opcua/server/config"}]},scopedSlots:e._u([{key:"default",fn:function({s:n}){return[r("vuci-form-item-switch",{attrs:{"uci-section":n,name:"enabled",label:e.$t("Enable"),help:e.$t("Whether the server is enabled.")}}),r("vuci-form-item-input",{attrs:{"uci-section":n,name:"name",label:e.$t("Name"),help:e.$t("Name of the server (no functional use)."),rules:["uciname",o=>e.serverExists(o)],required:""}}),r("vuci-form-item-input",{attrs:{"uci-section":n,name:"url",label:e.$t("URL"),help:e.$t("OPC UA endpoint URL."),rules:e.validateOpcUrl,required:""}}),r("vuci-form-item-input",{attrs:{"uci-section":n,name:"timeout",label:e.$t("Timeout"),help:e.$t("Server timeout (ms)."),placeholder:"5000",initial:"5000",rules:"irange(10,3600000)",required:""}})]}}],null,!0)}),r("vuci-typed-section",{attrs:{"uci-data":i,type:"server_node_"+e.section.id,title:e.$t("OPC UA server nodes"),"data-key":"serverNodes",endpoints:[{endpoint:`opcua/server/${e.section.id}/nodes/config`}],columns:e.serverNodeColumns,"edit-form":e.editServerNodeModal,"after-delete":e.onServerNodeDelete},scopedSlots:e._u([{key:"name",fn:function({s:n}){return[r("vuci-form-item-dummy",{attrs:{"uci-section":n,name:"name"}})]}},{key:"test",fn:function({s:n}){return[r("opcua-test",{attrs:{"uci-section":n,"get-data":e.getServerNodeTestData,endpoint:`/api/opcua/server/${n[".type"].split("_")[2]}/nodes/actions/test`}})]}},{key:"addForm",fn:function({addModel:n}){return[r("tlt-form-item-input",{attrs:{label:e.$t("Server node name"),prop:"name",rules:["uciname",o=>e.serverNodeExists(o),e.nodeLimit],required:""},model:{value:n.name,callback:function(o){e.$set(n,"name",o)},expression:"addModel.name"}})]}}],null,!0)})]}}]),model:{value:e.formData,callback:function(i){e.formData=i},expression:"formData"}})},Y=[],ee=_(Z,Q,Y,!1,null,null,null,null);const te=ee.exports,re={props:{section:{type:Object,required:!0}},data(){return{formData:{}}},computed:{getServerOptions(){return this.formData.server.map(t=>[t.id,t.name])},getServerNodeOptions(){return this.formData.serverNodes.filter(t=>t[".type"]===`server_node_${this.section.server}`).map(t=>[t.id,t.name])}},methods:{valueExistsInGroup(t){return this.formData.groupValue.filter(e=>e[".type"]===this.section[".type"]&&e.name===t).length>1?{isValid:!1,message:this.$t("Instance '%s' already exists").format(t)}:{isValid:!0}},loadData(){const t=this.formData.serverNodes.find(r=>r.id===this.section.server_node);if(!t)return Promise.resolve();const e=t[".type"].split("_")[2];return this.$set(this.section,"server",e),Promise.resolve()}}};var ne=function(){var e=this,r=e._self._c;return r("vuci-form",{attrs:{config:"opcua_client","after-load":e.loadData,editing:""},scopedSlots:e._u([{key:"default",fn:function({uciData:i}){return[r("vuci-named-section",{attrs:{"uci-data":i,name:e.section.id,title:e.$t("OPC UA group value configuration"),"data-key":"groupValue",endpoints:[{endpoint:`opcua/group/${e.section[".type"].split("_")[1]}/values/config`}]},scopedSlots:e._u([{key:"default",fn:function({s:n}){return[r("vuci-form-item-switch",{attrs:{"uci-section":n,name:"enabled",label:e.$t("Enabled"),help:e.$t("Whether the value is enabled.")}}),r("vuci-form-item-input",{attrs:{"uci-section":n,name:"name",label:e.$t("Name"),help:e.$t("Name of the value (no functional use)."),rules:["uciname",o=>e.valueExistsInGroup(o)],required:""}}),r("vuci-form-item-input",{attrs:{"uci-section":n,name:"prefix",label:e.$t("Prefix"),help:e.$t("String before the value.")}}),r("vuci-form-item-input",{attrs:{"uci-section":n,name:"postfix",label:e.$t("Postfix"),help:e.$t("String after the value.")}}),r("vuci-form-item-input",{attrs:{"uci-section":n,name:"replacement",label:e.$t("Replacement"),help:e.$t("String to replace everything in case of failure.")}}),r("vuci-form-item-select",{attrs:{"uci-section":n,name:"server",label:e.$t("Server"),help:e.$t("Server to retrieve data from."),required:"",options:e.getServerOptions,"no-write":""}}),r("vuci-form-item-select",{attrs:{"uci-section":n,name:"server_node",label:e.$t("Server node"),help:e.$t("Server node to retrieve data from."),required:"",options:e.getServerNodeOptions}})]}}],null,!0)})]}}]),model:{value:e.formData,callback:function(i){e.formData=i},expression:"formData"}})},ie=[],oe=_(re,ne,ie,!1,null,null,null,null);const se=oe.exports,k=50,ae={components:{OpcuaTest:S},props:{section:{type:Object,required:!0}},data(){return{formData:{},editGroupValueModal:se,groupValueColumns:[{name:"name",label:this.$t("Group value name")},{name:"test",label:this.$t("Test group value")},{name:"enabled",label:this.$t("Enabled")}],testForm:{},testResponse:"",schedulingTypeOptions:[["0",this.$t("Period")]],failModeOptions:[["0",this.$t("None")],["1",this.$t("Any")],["2",this.$t("All")]]}},computed:{sectionsGroupValues(){return this.formData.groupValue.filter(t=>t[".type"]===`value_${this.section.id}`)}},methods:{groupValueExists(t){return{isValid:!this.sectionsGroupValues.some(e=>e.name===t),message:this.$t("Instance '%s' already exists").format(t)}},groupExists(t){return{isValid:this.formData.group.filter(e=>e.name===t).length<=1,message:this.$t("Instance '%s' already exists").format(t)}},getGroupValueTestData(t){return{prefix:t.prefix,postfix:t.postfix,replacement:t.replacement,server_node:t.server_node}},groupValueLimit(){return{isValid:this.sectionsGroupValues.length<k,message:this.$t("Group value limit was reached (%s max)").format(k)}}}};var ue=function(){var e=this,r=e._self._c;return r("vuci-form",{attrs:{config:"opcua_client",editing:""},scopedSlots:e._u([{key:"default",fn:function({uciData:i}){return[r("vuci-named-section",{attrs:{name:e.section.id,"uci-data":i,title:e.$t("OPC UA value group configuration"),"data-key":"group",endpoints:[{endpoint:"opcua/group/config"}]},scopedSlots:e._u([{key:"default",fn:function({s:n}){return[r("vuci-form-item-switch",{attrs:{"uci-section":n,name:"enabled",label:e.$t("Enable"),help:e.$t("Whether the value is enabled.")}}),r("vuci-form-item-input",{attrs:{"uci-section":n,name:"name",label:e.$t("Name"),help:e.$t("Name of the server node."),rules:["uciname",o=>e.groupExists(o)],required:""}}),r("vuci-form-item-select",{attrs:{"uci-section":n,name:"scheduling_type",label:e.$t("Scheduling type"),help:e.$t("Method of scheduling data retrievals."),options:e.schedulingTypeOptions}}),r("vuci-form-item-input",{attrs:{"uci-section":n,name:"period",label:e.$t("Period"),help:e.$t("Time duration between data retrievals (s)."),placeholder:"60",initial:"60",rules:"irange(1,86400)",required:""}}),r("vuci-form-item-select",{attrs:{"uci-section":n,name:"fail_mode",label:e.$t("Failure mode"),help:e.$t("When to consider retrieval a failure."),options:e.failModeOptions}}),r("vuci-form-item-switch",{attrs:{"uci-section":n,name:"fail_store",label:e.$t("Failure storage"),help:e.$t("Whether to store results of a failure."),depend:n.fail_mode!=="0"}}),r("vuci-form-item-input",{attrs:{"uci-section":n,name:"replacement",label:e.$t("Failure replacement"),help:e.$t("String to replace results of a failure."),placeholder:"null"}}),r("vuci-form-item-input",{attrs:{"uci-section":n,name:"prefix",label:e.$t("Prefix"),help:e.$t("String going before all the values."),placeholder:"["}}),r("vuci-form-item-input",{attrs:{"uci-section":n,name:"midfix",label:e.$t("Midfix"),help:e.$t("String going between all the values."),placeholder:","}}),r("vuci-form-item-input",{attrs:{"uci-section":n,name:"postfix",label:e.$t("Postfix"),help:e.$t("String going after all the values."),placeholder:"]"}})]}}],null,!0)}),r("vuci-typed-section",{attrs:{"uci-data":i,type:"value_"+e.section.id,title:e.$t("OPC UA group values"),"data-key":"groupValue",endpoints:[{endpoint:`opcua/group/${e.section.id}/values/config`}],columns:e.groupValueColumns,"edit-form":e.editGroupValueModal},scopedSlots:e._u([{key:"name",fn:function({s:n}){return[r("vuci-form-item-dummy",{attrs:{"uci-section":n,name:"name"}})]}},{key:"enabled",fn:function({s:n}){return[r("vuci-form-item-switch",{attrs:{"uci-section":n,name:"enabled"}})]}},{key:"test",fn:function({s:n}){return[r("opcua-test",{attrs:{"uci-section":n,"get-data":e.getGroupValueTestData,endpoint:`/api/opcua/group/${n[".type"].split("_")[1]}/values/actions/test`,"show-response":!0}})]}},{key:"addForm",fn:function({addModel:n}){return[r("tlt-form-item-input",{attrs:{label:e.$t("Value name"),prop:"name",rules:["uciname",o=>e.groupValueExists(o),e.groupValueLimit],required:""},model:{value:n.name,callback:function(o){e.$set(n,"name",o)},expression:"addModel.name"}})]}}],null,!0)})]}}]),model:{value:e.formData,callback:function(i){e.formData=i},expression:"formData"}})},ce=[],le=_(ae,ue,ce,!1,null,null,null,null);const de=le.exports,fe={inject:["form"],methods:{afterSave(t,e){this.form().globalStatus=e.data.enabled==="1"}}};var pe=function(){var e=this,r=e._self._c;return r("vuci-form",{attrs:{editing:"",config:"opcua_client"},scopedSlots:e._u([{key:"default",fn:function({uciData:i}){return[r("vuci-named-section",{attrs:{name:"globals",title:e.$t("OPC UA Global Settings"),"uci-data":i,endpoints:[{endpoint:"opcua/global"}],"data-key":"global","after-save":e.afterSave},scopedSlots:e._u([{key:"default",fn:function({s:n}){return[r("vuci-form-item-switch",{attrs:{"uci-section":n,name:"enabled",label:e.$t("Enabled"),initial:"0",help:e.$t("Turn on/off OPC UA service")}})]}}],null,!0)})]}}])})},me=[],ve=_(fe,pe,me,!1,null,null,null,null);const he=ve.exports;/*!
 * vuex v3.6.2
 * (c) 2021 Evan You
 * @license MIT
 */function _e(t){var e=Number(t.version.split(".")[0]);if(e>=2)t.mixin({beforeCreate:i});else{var r=t.prototype._init;t.prototype._init=function(n){n===void 0&&(n={}),n.init=n.init?[i].concat(n.init):i,r.call(this,n)}}function i(){var n=this.$options;n.store?this.$store=typeof n.store=="function"?n.store():n.store:n.parent&&n.parent.$store&&(this.$store=n.parent.$store)}}var ge=typeof window<"u"?window:typeof global<"u"?global:{},$=ge.__VUE_DEVTOOLS_GLOBAL_HOOK__;function be(t){$&&(t._devtoolHook=$,$.emit("vuex:init",t),$.on("vuex:travel-to-state",function(e){t.replaceState(e)}),t.subscribe(function(e,r){$.emit("vuex:mutation",e,r)},{prepend:!0}),t.subscribeAction(function(e,r){$.emit("vuex:action",e,r)},{prepend:!0}))}function b(t,e){Object.keys(t).forEach(function(r){return e(t[r],r)})}function A(t){return t!==null&&typeof t=="object"}function ye(t){return t&&typeof t.then=="function"}function v(t,e){if(!t)throw new Error("[vuex] "+e)}function $e(t,e){return function(){return t(e)}}var g=function(e,r){this.runtime=r,this._children=Object.create(null),this._rawModule=e;var i=e.state;this.state=(typeof i=="function"?i():i)||{}},G={namespaced:{configurable:!0}};G.namespaced.get=function(){return!!this._rawModule.namespaced},g.prototype.addChild=function(e,r){this._children[e]=r},g.prototype.removeChild=function(e){delete this._children[e]},g.prototype.getChild=function(e){return this._children[e]},g.prototype.hasChild=function(e){return e in this._children},g.prototype.update=function(e){this._rawModule.namespaced=e.namespaced,e.actions&&(this._rawModule.actions=e.actions),e.mutations&&(this._rawModule.mutations=e.mutations),e.getters&&(this._rawModule.getters=e.getters)},g.prototype.forEachChild=function(e){b(this._children,e)},g.prototype.forEachGetter=function(e){this._rawModule.getters&&b(this._rawModule.getters,e)},g.prototype.forEachAction=function(e){this._rawModule.actions&&b(this._rawModule.actions,e)},g.prototype.forEachMutation=function(e){this._rawModule.mutations&&b(this._rawModule.mutations,e)},Object.defineProperties(g.prototype,G);var y=function(e){this.register([],e,!1)};y.prototype.get=function(e){return e.reduce(function(r,i){return r.getChild(i)},this.root)},y.prototype.getNamespace=function(e){var r=this.root;return e.reduce(function(i,n){return r=r.getChild(n),i+(r.namespaced?n+"/":"")},"")},y.prototype.update=function(e){M([],this.root,e)},y.prototype.register=function(e,r,i){var n=this;i===void 0&&(i=!0),process.env.NODE_ENV!=="production"&&P(e,r);var o=new g(r,i);if(e.length===0)this.root=o;else{var a=this.get(e.slice(0,-1));a.addChild(e[e.length-1],o)}r.modules&&b(r.modules,function(l,s){n.register(e.concat(s),l,i)})},y.prototype.unregister=function(e){var r=this.get(e.slice(0,-1)),i=e[e.length-1],n=r.getChild(i);if(!n){process.env.NODE_ENV!=="production"&&console.warn("[vuex] trying to unregister module '"+i+"', which is not registered");return}n.runtime&&r.removeChild(i)},y.prototype.isRegistered=function(e){var r=this.get(e.slice(0,-1)),i=e[e.length-1];return r?r.hasChild(i):!1};function M(t,e,r){if(process.env.NODE_ENV!=="production"&&P(t,r),e.update(r),r.modules)for(var i in r.modules){if(!e.getChild(i)){process.env.NODE_ENV!=="production"&&console.warn("[vuex] trying to add a new module '"+i+"' on hot reloading, manual reload is needed");return}M(t.concat(i),e.getChild(i),r.modules[i])}}var R={assert:function(t){return typeof t=="function"},expected:"function"},Ee={assert:function(t){return typeof t=="function"||typeof t=="object"&&typeof t.handler=="function"},expected:'function or object with "handler" function'},T={getters:R,mutations:R,actions:Ee};function P(t,e){Object.keys(T).forEach(function(r){if(e[r]){var i=T[r];b(e[r],function(n,o){v(i.assert(n),Ne(t,r,o,n,i.expected))})}})}function Ne(t,e,r,i,n){var o=e+" should be "+n+' but "'+e+"."+r+'"';return t.length>0&&(o+=' in module "'+t.join(".")+'"'),o+=" is "+JSON.stringify(i)+".",o}var m,h=function t(e){var r=this;e===void 0&&(e={}),!m&&typeof window<"u"&&window.Vue&&Ce(window.Vue),process.env.NODE_ENV!=="production"&&(v(m,"must call Vue.use(Vuex) before creating a store instance."),v(typeof Promise<"u","vuex requires a Promise polyfill in this browser."),v(this instanceof t,"store must be called with the new operator."));var i=e.plugins;i===void 0&&(i=[]);var n=e.strict;n===void 0&&(n=!1),this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new y(e),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._watcherVM=new m,this._makeLocalGettersCache=Object.create(null);var o=this,a=this,l=a.dispatch,s=a.commit;this.dispatch=function(f,p){return l.call(o,f,p)},this.commit=function(f,p,O){return s.call(o,f,p,O)},this.strict=n;var d=this._modules.root.state;N(this,d,[],this._modules.root),w(this,d),i.forEach(function(c){return c(r)});var u=e.devtools!==void 0?e.devtools:m.config.devtools;u&&be(this)},V={state:{configurable:!0}};V.state.get=function(){return this._vm._data.$$state},V.state.set=function(t){process.env.NODE_ENV!=="production"&&v(!1,"use store.replaceState() to explicit replace store state.")},h.prototype.commit=function(e,r,i){var n=this,o=x(e,r,i),a=o.type,l=o.payload,s=o.options,d={type:a,payload:l},u=this._mutations[a];if(!u){process.env.NODE_ENV!=="production"&&console.error("[vuex] unknown mutation type: "+a);return}this._withCommit(function(){u.forEach(function(f){f(l)})}),this._subscribers.slice().forEach(function(c){return c(d,n.state)}),process.env.NODE_ENV!=="production"&&s&&s.silent&&console.warn("[vuex] mutation type: "+a+". Silent option has been removed. Use the filter functionality in the vue-devtools")},h.prototype.dispatch=function(e,r){var i=this,n=x(e,r),o=n.type,a=n.payload,l={type:o,payload:a},s=this._actions[o];if(!s){process.env.NODE_ENV!=="production"&&console.error("[vuex] unknown action type: "+o);return}try{this._actionSubscribers.slice().filter(function(u){return u.before}).forEach(function(u){return u.before(l,i.state)})}catch(u){process.env.NODE_ENV!=="production"&&(console.warn("[vuex] error in before action subscribers: "),console.error(u))}var d=s.length>1?Promise.all(s.map(function(u){return u(a)})):s[0](a);return new Promise(function(u,c){d.then(function(f){try{i._actionSubscribers.filter(function(p){return p.after}).forEach(function(p){return p.after(l,i.state)})}catch(p){process.env.NODE_ENV!=="production"&&(console.warn("[vuex] error in after action subscribers: "),console.error(p))}u(f)},function(f){try{i._actionSubscribers.filter(function(p){return p.error}).forEach(function(p){return p.error(l,i.state,f)})}catch(p){process.env.NODE_ENV!=="production"&&(console.warn("[vuex] error in error action subscribers: "),console.error(p))}c(f)})})},h.prototype.subscribe=function(e,r){return j(e,this._subscribers,r)},h.prototype.subscribeAction=function(e,r){var i=typeof e=="function"?{before:e}:e;return j(i,this._actionSubscribers,r)},h.prototype.watch=function(e,r,i){var n=this;return process.env.NODE_ENV!=="production"&&v(typeof e=="function","store.watch only accepts a function."),this._watcherVM.$watch(function(){return e(n.state,n.getters)},r,i)},h.prototype.replaceState=function(e){var r=this;this._withCommit(function(){r._vm._data.$$state=e})},h.prototype.registerModule=function(e,r,i){i===void 0&&(i={}),typeof e=="string"&&(e=[e]),process.env.NODE_ENV!=="production"&&(v(Array.isArray(e),"module path must be a string or an Array."),v(e.length>0,"cannot register the root module by using registerModule.")),this._modules.register(e,r),N(this,this.state,e,this._modules.get(e),i.preserveState),w(this,this.state)},h.prototype.unregisterModule=function(e){var r=this;typeof e=="string"&&(e=[e]),process.env.NODE_ENV!=="production"&&v(Array.isArray(e),"module path must be a string or an Array."),this._modules.unregister(e),this._withCommit(function(){var i=D(r.state,e.slice(0,-1));m.delete(i,e[e.length-1])}),U(this)},h.prototype.hasModule=function(e){return typeof e=="string"&&(e=[e]),process.env.NODE_ENV!=="production"&&v(Array.isArray(e),"module path must be a string or an Array."),this._modules.isRegistered(e)},h.prototype.hotUpdate=function(e){this._modules.update(e),U(this,!0)},h.prototype._withCommit=function(e){var r=this._committing;this._committing=!0,e(),this._committing=r},Object.defineProperties(h.prototype,V);function j(t,e,r){return e.indexOf(t)<0&&(r&&r.prepend?e.unshift(t):e.push(t)),function(){var i=e.indexOf(t);i>-1&&e.splice(i,1)}}function U(t,e){t._actions=Object.create(null),t._mutations=Object.create(null),t._wrappedGetters=Object.create(null),t._modulesNamespaceMap=Object.create(null);var r=t.state;N(t,r,[],t._modules.root,!0),w(t,r,e)}function w(t,e,r){var i=t._vm;t.getters={},t._makeLocalGettersCache=Object.create(null);var n=t._wrappedGetters,o={};b(n,function(l,s){o[s]=$e(l,t),Object.defineProperty(t.getters,s,{get:function(){return t._vm[s]},enumerable:!0})});var a=m.config.silent;m.config.silent=!0,t._vm=new m({data:{$$state:e},computed:o}),m.config.silent=a,t.strict&&De(t),i&&(r&&t._withCommit(function(){i._data.$$state=null}),m.nextTick(function(){return i.$destroy()}))}function N(t,e,r,i,n){var o=!r.length,a=t._modules.getNamespace(r);if(i.namespaced&&(t._modulesNamespaceMap[a]&&process.env.NODE_ENV!=="production"&&console.error("[vuex] duplicate namespace "+a+" for the namespaced module "+r.join("/")),t._modulesNamespaceMap[a]=i),!o&&!n){var l=D(e,r.slice(0,-1)),s=r[r.length-1];t._withCommit(function(){process.env.NODE_ENV!=="production"&&s in l&&console.warn('[vuex] state field "'+s+'" was overridden by a module with the same name at "'+r.join(".")+'"'),m.set(l,s,i.state)})}var d=i.context=xe(t,a,r);i.forEachMutation(function(u,c){var f=a+c;Se(t,f,u,d)}),i.forEachAction(function(u,c){var f=u.root?c:a+c,p=u.handler||u;Ve(t,f,p,d)}),i.forEachGetter(function(u,c){var f=a+c;we(t,f,u,d)}),i.forEachChild(function(u,c){N(t,e,r.concat(c),u,n)})}function xe(t,e,r){var i=e==="",n={dispatch:i?t.dispatch:function(o,a,l){var s=x(o,a,l),d=s.payload,u=s.options,c=s.type;if((!u||!u.root)&&(c=e+c,process.env.NODE_ENV!=="production"&&!t._actions[c])){console.error("[vuex] unknown local action type: "+s.type+", global type: "+c);return}return t.dispatch(c,d)},commit:i?t.commit:function(o,a,l){var s=x(o,a,l),d=s.payload,u=s.options,c=s.type;if((!u||!u.root)&&(c=e+c,process.env.NODE_ENV!=="production"&&!t._mutations[c])){console.error("[vuex] unknown local mutation type: "+s.type+", global type: "+c);return}t.commit(c,d,u)}};return Object.defineProperties(n,{getters:{get:i?function(){return t.getters}:function(){return Oe(t,e)}},state:{get:function(){return D(t.state,r)}}}),n}function Oe(t,e){if(!t._makeLocalGettersCache[e]){var r={},i=e.length;Object.keys(t.getters).forEach(function(n){if(n.slice(0,i)===e){var o=n.slice(i);Object.defineProperty(r,o,{get:function(){return t.getters[n]},enumerable:!0})}}),t._makeLocalGettersCache[e]=r}return t._makeLocalGettersCache[e]}function Se(t,e,r,i){var n=t._mutations[e]||(t._mutations[e]=[]);n.push(function(a){r.call(t,i.state,a)})}function Ve(t,e,r,i){var n=t._actions[e]||(t._actions[e]=[]);n.push(function(a){var l=r.call(t,{dispatch:i.dispatch,commit:i.commit,getters:i.getters,state:i.state,rootGetters:t.getters,rootState:t.state},a);return ye(l)||(l=Promise.resolve(l)),t._devtoolHook?l.catch(function(s){throw t._devtoolHook.emit("vuex:error",s),s}):l})}function we(t,e,r,i){if(t._wrappedGetters[e]){process.env.NODE_ENV!=="production"&&console.error("[vuex] duplicate getter key: "+e);return}t._wrappedGetters[e]=function(o){return r(i.state,i.getters,o.state,o.getters)}}function De(t){t._vm.$watch(function(){return this._data.$$state},function(){process.env.NODE_ENV!=="production"&&v(t._committing,"do not mutate vuex store state outside mutation handlers.")},{deep:!0,sync:!0})}function D(t,e){return e.reduce(function(r,i){return r[i]},t)}function x(t,e,r){return A(t)&&t.type&&(r=e,e=t,t=t.type),process.env.NODE_ENV!=="production"&&v(typeof t=="string","expects string as the type, but found "+typeof t+"."),{type:t,payload:e,options:r}}function Ce(t){if(m&&t===m){process.env.NODE_ENV!=="production"&&console.error("[vuex] already installed. Vue.use(Vuex) should be called only once.");return}m=t,_e(m)}var ke=Ge(function(t,e){var r={};return process.env.NODE_ENV!=="production"&&!q(e)&&console.error("[vuex] mapGetters: mapper parameter must be either an Array or an Object"),Ae(e).forEach(function(i){var n=i.key,o=i.val;o=t+o,r[n]=function(){if(!(t&&!Me(this.$store,"mapGetters",t))){if(process.env.NODE_ENV!=="production"&&!(o in this.$store.getters)){console.error("[vuex] unknown getter: "+o);return}return this.$store.getters[o]}},r[n].vuex=!0}),r});function Ae(t){return q(t)?Array.isArray(t)?t.map(function(e){return{key:e,val:e}}):Object.keys(t).map(function(e){return{key:e,val:t[e]}}):[]}function q(t){return Array.isArray(t)||A(t)}function Ge(t){return function(e,r){return typeof e!="string"?(r=e,e=""):e.charAt(e.length-1)!=="/"&&(e+="/"),t(e,r)}}function Me(t,e,r){var i=t._modulesNamespaceMap[r];return process.env.NODE_ENV!=="production"&&!i&&console.error("[vuex] module namespace not found in "+e+"(): "+r),i}const I=10,L=20,Re={components:{OpcuaTest:S},provide(){return{form:()=>this.globalEnabled}},data(){return{editServerModal:te,editGroupModal:de,opcuaGlobal:he,serverColumns:[{name:"name",label:this.$t("Name")},{name:"test",label:this.$t("Test server")},{name:"enabled",label:this.$t("Enabled")}],groupColumns:[{name:"name",label:this.$t("Name")},{name:"test",label:this.$t("Test value group")},{name:"enabled",label:this.$t("Enabled")}],formData:{},globalEnabled:{globalStatus:"firstLoad"},stateChanged:!1,infoMessage:this.$t("%s service is disabled, navigate to global settings configuration to enable it.").format("OPC UA")}},watch:{"globalEnabled.globalStatus":function(t,e){e==="firstLoad"?t||this.$alert.info(this.infoMessage):this.stateChanged=!0},modalOpen(t){!t&&this.stateChanged&&(this.stateChanged=!1,this.globalEnabled.globalStatus?this.$alert.remove(this.infoMessage):this.$alert.info(this.infoMessage))}},computed:{...ke(["modalOpen"])},methods:{loadData(t){const e=t.server.map(n=>`/api/opcua/server/${n.id}/nodes/config`),r=t.group.map(n=>`/api/opcua/group/${n.id}/values/config`),i=["/api/opcua/global",...e,...r];return this.$axios.bulkGet(i).then(n=>{const o=n.shift();o.success?this.globalEnabled.globalStatus=o.data.enabled==="1":this.$message.error(this.$t("Failed to load OPC UA global data"));const a=n.map(({data:d})=>d).flat(),l=a.filter(d=>d[".type"].split("_")[0]==="server"),s=a.filter(d=>d[".type"].split("_")[0]==="value");return{serverNodes:l,groupValue:s}}).catch(()=>{this.$message.error(this.$t("An unexpected error occurred."))})},instanceExists(t,e){return this.formData[e].some(r=>r.name===t)?{isValid:!1,message:this.$t("Instance '%s' already exists").format(t)}:{isValid:!0}},getServerTestData(t){return{url:t.url,timeout:t.timeout}},getGroupTestData(t){return{fail_mode:t.fail_mode,replacement:t.replacement,prefix:t.prefix,midfix:t.midfix,postfix:t.postfix,values:this.groupValueNames(t)}},groupValueNames(t){return this.formData.groupValue.filter(e=>e[".type"]===`value_${t.id}`).map(e=>e.id)},onServerDelete(t,e){const r=e.serverNodes.filter(i=>i[".type"]===`server_node_${t.id}`).map(i=>i.id);e.groupValue=e.groupValue.map(i=>({...i,enabled:r.includes(i.server_node)?"0":i.enabled})),e.serverNodes=e.serverNodes.filter(i=>i[".type"]!==`server_node_${t.id}`)},onGroupDelete(t,e){e.groupValue=e.groupValue.filter(r=>r[".type"]!==`value_${t.id}`)},onServerEnable({uciSection:t},e){e==="1"&&!t.url&&!t.timeout&&(this.$message.error(this.$t("Can only be enabled when all required fields are filled")),this.$set(t,"enabled","0"))},serverLimit(){return{isValid:this.formData.server.length<I,message:this.$t("Server limit was reached (%s max)").format(I)}},groupLimit(){return{isValid:this.formData.group.length<L,message:this.$t("Group limit was reached (%s max)").format(L)}}}};var Te=function(){var e=this,r=e._self._c;return r("vuci-form",{attrs:{config:"opcua_client","after-load":e.loadData},scopedSlots:e._u([{key:"default",fn:function({uciData:i}){return[r("vuci-typed-section",{attrs:{"uci-data":i,type:"server",title:e.$t("OPC UA servers"),"data-key":"server",endpoints:[{endpoint:"opcua/server/config"}],columns:e.serverColumns,"edit-form":e.editServerModal,"after-delete":e.onServerDelete,"global-settings-form":e.opcuaGlobal},scopedSlots:e._u([{key:"name",fn:function({s:n}){return[r("vuci-form-item-dummy",{attrs:{"uci-section":n,name:"name"}})]}},{key:"enabled",fn:function({s:n}){return[r("vuci-form-item-switch",{attrs:{"uci-section":n,name:"enabled"},on:{change:e.onServerEnable}})]}},{key:"test",fn:function({s:n}){return[r("opcua-test",{attrs:{"uci-section":n,"get-data":e.getServerTestData,endpoint:"/api/opcua/server/actions/test"}})]}},{key:"addForm",fn:function({addModel:n}){return[r("tlt-form-item-input",{attrs:{label:e.$t("Server name"),prop:"name",rules:["uciname",o=>e.instanceExists(o,"server"),e.serverLimit],required:""},model:{value:n.name,callback:function(o){e.$set(n,"name",o)},expression:"addModel.name"}})]}}],null,!0)}),r("vuci-typed-section",{attrs:{"uci-data":i,type:"value_group",title:e.$t("OPC UA value groups"),"data-key":"group",endpoints:[{endpoint:"opcua/group/config"}],columns:e.groupColumns,"edit-form":e.editGroupModal,"after-delete":e.onGroupDelete},scopedSlots:e._u([{key:"name",fn:function({s:n}){return[r("vuci-form-item-dummy",{attrs:{"uci-section":n,name:"name"}})]}},{key:"enabled",fn:function({s:n}){return[r("vuci-form-item-switch",{attrs:{"uci-section":n,name:"enabled"}})]}},{key:"test",fn:function({s:n}){return[r("opcua-test",{attrs:{"uci-section":n,"get-data":e.getGroupTestData,endpoint:"/api/opcua/group/actions/test","show-response":!0}})]}},{key:"addForm",fn:function({addModel:n}){return[r("tlt-form-item-input",{attrs:{label:e.$t("Value group name"),prop:"name",rules:["uciname",o=>e.instanceExists(o,"group"),e.groupLimit],required:""},model:{value:n.name,callback:function(o){e.$set(n,"name",o)},expression:"addModel.name"}})]}}],null,!0)})]}}]),model:{value:e.formData,callback:function(i){e.formData=i},expression:"formData"}})},Pe=[],je=_(Re,Te,Pe,!1,null,null,null,null);return je.exports});
