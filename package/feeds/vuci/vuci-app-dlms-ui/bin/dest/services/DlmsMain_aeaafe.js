(function(g,D){typeof exports=="object"&&typeof module<"u"?module.exports=D():typeof define=="function"&&define.amd?define(D):(g=typeof globalThis<"u"?globalThis:g||self,g["services/DlmsMain_js"]=D())})(this,function(){"use strict";function g(i,e,t,s,n,o,a,c){var r=typeof i=="function"?i.options:i;e&&(r.render=e,r.staticRenderFns=t,r._compiled=!0),s&&(r.functional=!0),o&&(r._scopeId="data-v-"+o);var l;if(a?(l=function(f){f=f||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!f&&typeof __VUE_SSR_CONTEXT__<"u"&&(f=__VUE_SSR_CONTEXT__),n&&n.call(this,f),f&&f._registeredComponents&&f._registeredComponents.add(a)},r._ssrRegister=l):n&&(l=c?function(){n.call(this,(r.functional?this.parent:this).$root.$options.shadowRoot)}:n),l)if(r.functional){r._injectStyles=l;var d=r.render;r.render=function(h,C){return l.call(C),d(h,C)}}else{var u=r.beforeCreate;r.beforeCreate=u?[].concat(u,l):[l]}return{exports:i,options:r}}const D={inject:["formOptions"],props:{section:{type:Object,required:!0},father:{type:String,required:!0}},data(){return{formData:{},cosemList:[["1",this.$t("DATA (ID: %s)").format("1")],["3",this.$t("REGISTER (ID: %s)").format("3")],["4",this.$t("EXTENDED REGISTER (ID: %s)").format("4")],["5",this.$t("DEMAND REGISTER (ID: %s)").format("5")],["6",this.$t("REGISTER ACTIVATION (ID: %s)").format("6")],["7",this.$t("PROFILE GENERIC (ID: %s)").format("7")],["8",this.$t("CLOCK (ID: %s)").format("8")],["9",this.$t("SCRIPT TABLE (ID: %s)").format("9")],["11",this.$t("SPECIAL DAYS TABLE (ID: %s)").format("11")],["15",this.$t("ASSOCIATION LOGICAL NAME (ID: %s)").format("15")],["17",this.$t("SAP ASSIGNMENT (ID: %s)").format("17")],["18",this.$t("IMAGE TRANSFER (ID: %s)").format("18")],["19",this.$t("IEC LOCAL PORT SETUP (ID: %s)").format("19")],["20",this.$t("ACTIVITY CALENDAR (ID: %s)").format("20")],["21",this.$t("REGISTER MONITOR (ID: %s)").format("21")],["22",this.$t("ACTION SCHEDULE (ID: %s)").format("22")],["23",this.$t("IEC HDLC SETUP (ID: %s)").format("23")],["24",this.$t("IEC TWISTED PAIR SETUP (ID: %s)").format("24")],["26",this.$t("UTILITY TABLES (ID: %s)").format("26")],["27",this.$t("MODEM CONFIGURATION (ID: %s)").format("27")],["28",this.$t("AUTO ANSWER (ID: %s)").format("28")],["29",this.$t("AUTO CONNECT (ID: %s)").format("29")],["40",this.$t("PUSH SETUP (ID: %s)").format("40")],["41",this.$t("TCP UDP SETUP (ID: %s)").format("41")],["42",this.$t("IP4 SETUP (ID: %s)").format("42")],["43",this.$t("MAC ADDRESS SETUP (ID: %s)").format("43")],["45",this.$t("GPRS SETUP (ID: %s)").format("45")],["47",this.$t("GSM DIAGNOSTIC (ID: %s)").format("47")],["48",this.$t("IP6 SETUP (ID: %s)").format("48")],["62",this.$t("COMPACT DATA (ID: %s)").format("62")],["64",this.$t("SECURITY SETUP (ID: %s)").format("64")],["68",this.$t("ARBITRATOR (ID: %s)").format("68")],["70",this.$t("DISCONNECT CONTROL (ID: %s)").format("70")],["71",this.$t("LIMITER (ID: %s)").format("71")]],sideMessageTxt:this.$t("Incorrectly configured TCP connection was detected, connection device values were removed from device select list"),removed:"not"}},beforeDestroy(){this.$alert.remove(this.sideMessageTxt)},methods:{validateName(){return this.formData[`${this.father}_cosem`].some(i=>i.name===this.section.name&&i.id!==this.section.id)?{valid:!1,message:this.$t("Name %s is already in use").format(this.section.name)}:{isValid:!0}},physicalDeviceOptions(){let i=[];const e=this.formData.connection.filter(t=>t.connection_type==="0"&&(!t.address||!t.port));return i=this.formData.device.filter(t=>t.connection&&!e.includes(t.connection)),i.map(t=>[t.id,t.name])},showMessage(){this.$alert.error(this.sideMessageTxt,!1)}}};var G=function(){var e=this,t=e._self._c;return t("vuci-form",{attrs:{config:"dlms_client",editing:""},scopedSlots:e._u([{key:"default",fn:function({uciData:s}){return[t("vuci-named-section",{attrs:{"uci-data":s,name:e.section.id,"data-key":`${e.father}_cosem`,endpoints:[{endpoint:`dlms/cosem_group/${e.father}/cosem/config`}],title:e.$t("DLMS COSEM value Configuration")},scopedSlots:e._u([{key:"default",fn:function({s:n}){return[t("vuci-form-item-switch",{attrs:{"uci-section":n,help:e.$t("COSEM state"),label:e.$t("Enabled"),name:"enabled"}}),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("Name"),help:e.$t("COSEM option name"),name:"name",maxlength:"200",rules:e.validateName,required:""}}),t("vuci-form-item-select",{attrs:{"uci-section":n,label:e.$t("Physical device"),help:e.$t("Physical device to read from"),name:"physical_device",multiple:"",required:"",options:e.physicalDeviceOptions()}}),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("OBIS Code"),help:e.$t("OBIS code value, actions are not executed, only properties are read."),name:"obis",maxlength:"32",rules:"string",required:""}}),t("vuci-form-item-select",{attrs:{"uci-section":n,label:e.$t("COSEM class id"),help:e.$t("Object type for OBIS code"),name:"cosem_id",options:e.cosemList}}),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("Entries"),help:e.$t("How many data objects to read"),name:"entries",required:"",rules:"irange(1,32767)",depend:n.cosem_id==="7"}})]}}],null,!0)})]}}]),model:{value:e.formData,callback:function(s){e.formData=s},expression:"formData"}})},j=[],F=g(D,G,j,!1,null,null,null,null);const q=F.exports,H={props:{section:{type:Object,required:!0}},data(){return{cosemEditModal:q,cosemColumns:[{name:"name",label:this.$t("Name"),help:this.$t("COSEM value name.")},{name:"enabled",label:this.$t("Enable"),help:this.$t("COSEM value configuration button.")},{name:"status"}],formData:{},testDisabled:!1,testResponse:"",status:[]}},computed:{associationNameEnabled(){return this.formData[`${this.section.id}_cosem`]?this.formData[`${this.section.id}_cosem`].some(i=>i.enabled==="1"&&i.cosem_id==="15"):!1},message(){return this.associationNameEnabled?this.$t("Test request might take a really long time with a COSEM that has Association logical name COSEM class."):""}},methods:{resetButton(i){this.formData[`${this.section.id}_cosem`].some(e=>e.enabled==="1")||(i.vuciForm.uciData.cosem_group.find(e=>e.id===this.section.id).enabled="0")},addValidate(i,e){return e.length<20?{valid:!0}:{valid:!1,message:this.$t("Maximum number of COSEM instances has been reached")}},formStatus(i,e=!1){const s=this.formData[`${this.section.id}_cosem`].filter(n=>n.enabled==="1").map(n=>{n.failed="",n.success="",n.hint=[];let o={},a=[];i&&!e&&(o=i.result,o[n.name]?a=Object.keys(o[n.name]).map(l=>({device:l,err:o[n.name][l].error,message:o[n.name][l].result})):(n.failed="1",n.hint=[{info:this.$t("Configuration test failed due to invalid configuration.")}]));let c="";return e&&(n.failed="1",n.hint=[{info:this.$t("Test configuration request failed")}]),a.length!==0&&a.some(r=>r.err)?(a.filter(l=>l.err).forEach(l=>{c=c+this.$t("%s failed with an error: %s %s").format(`<b>${l.device}</b>`,l.message,"</br>")}),n.failed="1",n.hint=[{info:c}]):!i.error&&n.failed!=="1"&&(n.hint=[],n.success="1"),n});this.status=s},test(i){const e=structuredClone(this.formData[`${this.section.id}_cosem`].filter(t=>t.enabled==="1"&&t.name));if(!e.length){this.$message.error(this.$t("There are no enabled objects in tested group"));return}return e.forEach(t=>{t.devices=t.physical_device,delete t.physical_device,delete t._md5,delete t[".type"]}),this.testDisabled=!0,this.$axios.post("/api/dlms/cosem_group/actions/test",{data:{object:e,pretty:"1"}}).then(({data:t})=>{this.testResponse=JSON.stringify(t,null,2),this.formStatus(t)}).catch(t=>{var s,n,o,a;if(this.formStatus({},!0),((a=(o=(n=(s=t.response)==null?void 0:s.data)==null?void 0:n.errors)==null?void 0:o[0])==null?void 0:a.code)===16)return this.$message.error(this.$t("There are no enabled connections, please enable a connection before using COSEM groups"));this.$message.error(this.$t("Failed to test request, encountered an unexpected error."))}).finally(()=>{this.testDisabled=!1})},validateEnable(i){i.model!=="0"&&(this.formData[`${this.section.id}_cosem`].some(e=>e.enabled==="1")||(i.model="0",this.$message.error(this.$t("To enable COSEM group at least one COSEM value needs to be enabled."))))}}};var U=function(){var e=this,t=e._self._c;return t("vuci-form",{attrs:{config:"dlms_client",editing:""},scopedSlots:e._u([{key:"default",fn:function({uciData:s}){return[t("vuci-named-section",{attrs:{"uci-data":s,name:e.section.id,"data-key":"cosem_group",endpoints:[{endpoint:"dlms/cosem_group/config"}],title:e.$t("DLMS COSEM Group Configuration")},scopedSlots:e._u([{key:"default",fn:function({s:n}){return[t("vuci-form-item-switch",{attrs:{"uci-section":n,help:e.$t("Value group state"),label:e.$t("Enabled"),name:"enabled"},on:{change:e.validateEnable}}),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("Name"),help:e.$t("OBIS code group name"),name:"name",maxlength:"200",required:""}}),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("Interval"),help:e.$t("Interval for OBIS code reading (in seconds)"),name:"interval",rules:"irange(1, 4294967295)",initial:"60",required:""}})]}}],null,!0)}),e.associationNameEnabled?t("tlt-inline-message",{attrs:{id:"config-change",message:e.message,type:"warning"}}):e._e(),t("vuci-form-item-button",{attrs:{"uci-section":{},label:" ",text:e.$t("Test"),name:"test",type:"button",readonly:e.testDisabled},on:{click:e.test}}),t("tlt-text-area",{staticClass:"mt-1.5",attrs:{"custom-id":"test-output",rows:"3",readonly:""},model:{value:e.testResponse,callback:function(n){e.testResponse=n},expression:"testResponse"}}),t("vuci-typed-section",{attrs:{type:"cosem",title:e.$t("DLMS COSEM value"),columns:e.cosemColumns,"uci-data":s,"edit-form":e.cosemEditModal,endpoints:[{endpoint:`dlms/cosem_group/${e.section.id}/cosem/config`}],"data-key":`${e.section.id}_cosem`,"add-validate":e.addValidate,"restricted-values":["name"],"add-title":e.$t("Add new COSEM value"),"edit-form-props":{father:e.section.id}},scopedSlots:e._u([{key:"enabled",fn:function({s:n}){return[t("vuci-form-item-switch",{attrs:{"uci-section":n,name:"enabled"},on:{change:e.resetButton}})]}},{key:"status",fn:function({s:n}){var o,a,c;return[t("tlt-hint",{attrs:{hints:((o=e.status.find(r=>r.id===n.id))==null?void 0:o.hint)||[],rawhtml:""}},[(a=e.status.find(r=>r.id===n.id))!=null&&a.failed?t("tlt-icon",{staticClass:"text-error-100",attrs:{icon:"warning"}}):e._e()],1),t("tlt-hint",{attrs:{hints:[]}},[(c=e.status.find(r=>r.id===n.id))!=null&&c.success?t("tlt-icon",{staticClass:"text-success-100",attrs:{icon:"success"}}):e._e()],1)]}}],null,!0)})]}}]),model:{value:e.formData,callback:function(s){e.formData=s},expression:"formData"}})},B=[],J=g(H,U,B,!1,null,null,null,null);const W=J.exports;new TextEncoder;function N(i){if(typeof i!="string"&&!(i instanceof String)||!i.match(/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/))return;const e=[],t=i.split(/\./);for(let s=0;s<t.length;s++){if(z(t[s]))return;const n=parseInt(t[s]);if(isNaN(n)||n>255)return;e.push(n)}return e}function Y(i){if(i.match(/^([a-fA-F0-9:]+):(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})$/)){const c=RegExp.$1,r=N(RegExp.$2);if(!r)return null;i=c+":"+(r[0]*256+r[1]).toString(16)+":"+(r[2]*256+r[3]).toString(16)}if(!i.match(/^[a-fA-F0-9:]+$/))return null;const e=i.split(/::/);if(e.length>2)return null;const t=(e[0]||"0").split(/:/),s=e.length>1?(e[1]||"0").split(/:/):[];if(s.length?t.length+s.length>7:e.length<2&&t.length<8||t.length>8)return null;let n,o;const a=[];for(n=0,o=parseInt(t[0],16);n<t.length;o=parseInt(t[++n],16))if(t[n].length<=4&&!isNaN(o)&&o<=65535)a.push(o);else return null;for(n=0;n<8-t.length-s.length;n++)a.push(0);for(n=0,o=parseInt(s[0],16);n<s.length;o=parseInt(s[++n],16))if(s[n].length<=4&&!isNaN(o)&&o<=65535)a.push(o);else return null;return a}function z(i){return!!i.match(/^((-0[0-9]*)|(0[0-9]+))| +/)}const X={props:{section:{type:Object,required:!0}},data(){return{formData:{},authenticationList:[["0",this.$t("None")],["1",this.$t("Low")],["2",this.$t("High")],["3",this.$t("HIGH MD5")],["4",this.$t("HIGH SHA1")],["5",this.$t("HIGH GMAC")]],defaultInterfaceTypeList:[["0",this.$t("HDLC")],["1",this.$t("WRAPPER")]],securityList:[["0",this.$t("NONE")],["16",this.$t("Authentication")],["32",this.$t("Encryption")],["48",this.$t("Authentication encryption")]],addressTypeList:[["0",this.$t("Default")],["1",this.$t("Serial Number")]],testDisabled:!1,testResponse:""}},computed:{interfaceTypeList(){var n,o;const i=[...this.defaultInterfaceTypeList];if(!this.connectionList.length)return i;const e=this.connectionList.some(a=>a[0]===this.section.connection)?this.section.connection:this.connectionList[0][0],t=(o=(n=this.formData)==null?void 0:n.connection)==null?void 0:o.find(a=>a.id===e);return t&&t.connection_type==="1"&&i.splice(1,0,["4",this.$t("HDLC with mode E")]),i},connectionList(){return this.formData.connection?this.formData.connection.map(i=>[i.id,i.name||this.$t("Name not provided")]):[]}},beforeDestroy(){this.$bus.emit("close-modal")},methods:{addAction(){return this.connectionList.length>29?this.$message.error(this.$t("Maximum number of connections has been reached")):this.$axios.post("/api/dlms/connections/config",{data:{}}).then(({data:i})=>{this.$bus.emit("redirect-to-tab",i.id,this.section.id)}).catch(()=>{this.$message.error(this.$t("Failed to add DLMS connection"))})},editAction(i){this.$bus.emit("redirect-to-tab",i,this.section.id)},validateDeviceName(){return Object.keys(this.formData).filter(t=>t.includes("device")).flatMap(t=>this.formData[t]).some(t=>t.name===this.section.name&&t.id!==this.section.id)?{isValid:!1,message:this.$t("Device with %s name already exists").format(this.section.name)}:{isValid:!0}},validate(i){const e=this.formData.device.find(t=>t.id===this.section.id);return this.connectionList.length||(e.connection=""),Promise.resolve()},test(i){return i.vuciForm.validate().then(e=>{var l,d;if(!e)throw new Error("invalid");const t=this.connectionList.some(u=>u[0]===this.section.connection)?this.section.connection:this.connectionList[0][0],s=(d=(l=this.formData)==null?void 0:l.connection)==null?void 0:d.find(u=>u.id===t);if(!s)throw new Error("noSection");if(!s.connection_type)throw new Error("noSection");const n=[],o={},a=["client_addr","server_addr_type","server_addr","log_server_addr"];let c=["connection_type"];if(s.connection_type==="0"&&(c=c.concat(["address","port"])),s.connection_type==="1"&&(c=c.concat(["device","baudrate","databits","stopbits","parity","flowcontrol"])),c.forEach(u=>{o[u]=s[u]||n.push(u)}),a.forEach(u=>{o[u]=this.section[u]}),["transport_security","interface","access_security","password","authentication_key","block_cipher_key","dedicated_key","invocation_counter","use_ln_ref"].forEach(u=>{this.section[u]&&(o[u]=this.section[u])}),n.length!==0)throw new Error("missingValues",{cause:n});return this.testDisabled=!0,this.$axios.post("/api/dlms/devices/actions/test",{data:o})}).then(({data:e})=>{this.testResponse=JSON.stringify(e)}).catch(e=>{const t={missingValues:this.$t("Some values are missing (%s)"),noSection:this.$t("Connection section is missing"),invalid:this.$t("Values used for testing are invalid")};if(e&&e.message&&t[e.message]&&e.cause)return this.$message.error(t[e.message].format(e.cause.toString()));if(e&&e.message&&t[e.message])return this.$message.error(t[e.message]);this.$message.error(this.$t("Failed to test request, encountered an unexpected error."))}).finally(()=>{this.testDisabled=!1})}}};var K=function(){var e=this,t=e._self._c;return t("vuci-form",{attrs:{editing:"","before-save":e.validate,config:"dlms_client"},scopedSlots:e._u([{key:"default",fn:function({uciData:s}){return[t("vuci-named-section",{attrs:{"uci-data":s,name:e.section.id,"data-key":"device",endpoints:[{endpoint:"dlms/devices/config"}],title:e.$t("DLMS Physical Device Configuration")},scopedSlots:e._u([{key:"default",fn:function({s:n}){return[t("vuci-form-item-switch",{attrs:{"uci-section":n,help:e.$t("Physical device state"),label:e.$t("Enabled"),name:"enabled"}}),t("tlt-form-model-item",{attrs:{label:e.$t("Connection"),help:e.$t("DLMS connection"),"element-id":"connection"}},[t("div",{staticClass:"flex"},[t("vuci-form-item-select",{staticClass:"!mb-0 min-w-[350px] min-[500px]:mb-0",attrs:{"uci-section":n,name:"connection",options:e.connectionList,required:""}}),t("tlt-button",{staticClass:"h-7 mr-2",on:{click:e.addAction}},[e._v(e._s(e.$t("Add")))]),e.connectionList.length!==0?t("tlt-button",{staticClass:"h-7",on:{click:function(o){return e.editAction(n.connection)}}},[e._v(e._s(e.$t("Edit")))]):e._e()],1)]),t("vuci-form-item-input",{staticClass:"mt-4",attrs:{"uci-section":n,label:e.$t("Name"),help:e.$t("Physical device name"),name:"name",maxlength:"200",rules:e.validateDeviceName,required:""}}),t("vuci-form-item-select",{attrs:{"uci-section":n,label:e.$t("Server address type"),help:e.$t("Select 'Default' for server address or 'Serial Number' for addressing by a specific serial number."),name:"server_addr_type",options:e.addressTypeList,initial:"0"}}),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("Server address"),help:e.$t("DLMS device server address"),name:"server_addr",initial:"1",rules:"irange(0, 255)",required:"",depend:n.server_addr_type==="0"}}),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("Serial number"),help:e.$t("DLMS device serial number. Uses formula 'SN % 10000 + 1000'"),name:"server_addr",rules:"uinteger",required:"",depend:n.server_addr_type==="1"}}),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("Logical server address"),help:e.$t("DLMS device logical server address"),name:"log_server_addr",required:"",initial:"0",rules:"irange(0, 255)"}}),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("Client address"),help:e.$t("DLMS device client address"),name:"client_addr",rules:"irange(0, 255)",initial:"16",required:""}}),t("vuci-form-item-select",{attrs:{"uci-section":n,label:e.$t("Access security"),help:e.$t("DLMS device authentication type"),name:"access_security",options:e.authenticationList,initial:"0"}}),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("Password"),help:e.$t("DLMS device password if authentication is used"),name:"password",rules:"string",password:"",required:"",depend:!["0","5"].includes(n.access_security)}}),t("vuci-form-item-select",{attrs:{"uci-section":n,label:e.$t("Interface type"),help:e.$t("DLMS device interface type"),name:"interface",options:e.interfaceTypeList,initial:"0"}}),t("vuci-form-item-select",{attrs:{"uci-section":n,label:e.$t("Transport security"),help:e.$t("DLMS device message encryption"),name:"transport_security",options:e.securityList,initial:"0"}}),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("Invocation counter OBIS code"),help:e.$t("DLMS device invocation counter OBIS code"),name:"invocation_counter",rules:"string",maxlength:"32",required:"",depend:n.transport_security!=="0"}}),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("Authentication key"),help:e.$t("DLMS device authentication key"),name:"authentication_key",rules:"string",maxlength:"32",minlength:"32",required:"",depend:["16","48"].includes(n.transport_security)||n.access_security==="5"}}),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("Block cipher key"),help:e.$t("DLMS device block cipher key"),name:"block_cipher_key",rules:"string",maxlength:"32",minlength:"32",required:"",depend:["32","48"].includes(n.transport_security)||n.access_security==="5"}}),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("Dedicated key"),help:e.$t("DLMS device dedicated key"),name:"dedicated_key",rules:"string",maxlength:"32",minlength:"32",depend:["32","48"].includes(n.transport_security)}}),t("vuci-form-item-switch",{attrs:{"uci-section":n,help:e.$t("Two types of referencing is available: short name and logical name. To determine what kind of referencing should be used, read device documentation"),label:e.$t("Logical name referencing"),name:"use_ln_ref",initial:"1"}})]}}],null,!0)}),t("vuci-form-item-button",{attrs:{"uci-section":{},label:" ",type:"button",text:e.$t("Test"),readonly:e.testDisabled||!e.connectionList.length,name:"test"},on:{click:e.test}}),t("br"),t("tlt-text-area",{staticClass:"mb-5",attrs:{"custom-id":"test-output",rows:"3",readonly:""},model:{value:e.testResponse,callback:function(n){e.testResponse=n},expression:"testResponse"}})]}}]),model:{value:e.formData,callback:function(s){e.formData=s},expression:"formData"}})},Z=[],Q=g(X,K,Z,!1,null,null,null,null);const ee=Q.exports,te={inject:["formOptions"],props:{section:{type:Object,required:!0}},data(){return{formData:{},initialDevice:""}},computed:{serialOptions(){return this.$serial.filterOptions(this.formOptions().serial,this.section.device,this.section,"external")},usedDevice(){return this.formOptions().status.find(i=>i.name===this.section.device&&i.is_used==="1")},noDevice(){return this.initialDevice?this.$serial.checkForExternalDevice(this.formOptions().device,{device:this.initialDevice}):!1}},beforeDestroy(){this.$bus.emit("close-modal"),this.$bus.emit("clear-values")},methods:{loadInitial(){this.initialDevice=this.section.device},onAfterSave(i,e){this.$bus.emit("redirect-to-device",e)},validateGroup(){return this.formData.connection.some(e=>e.id!==this.section.id&&e.port===this.section.port&&e.address===this.section.address)?{isValid:!1,message:this.$t("Address and port combination is already in use in another connection")}:{isValid:!0}},updateValidations(i){i.vuciSection.validate()},validate(){if(this.section.connection_type==="0")return Promise.resolve();const i=this.formOptions().status;return this.$serial.validateBeforeSave(i,this.formData.connection,"DLMS")}}};var ie=function(){var e=this,t=e._self._c;return t("vuci-form",{attrs:{config:"dlms_client",editing:"","after-load":e.loadInitial,"before-save":e.validate},scopedSlots:e._u([{key:"default",fn:function({uciData:s}){return[t("vuci-named-section",{attrs:{"uci-data":s,name:e.section.id,"data-key":"connection",endpoints:[{endpoint:"dlms/connections/config"}],"after-save":e.onAfterSave,title:e.$t("DLMS Connection Configuration")},scopedSlots:e._u([{key:"default",fn:function({s:n}){return[t("vuci-form-item-switch",{attrs:{"uci-section":n,name:"enabled",label:e.$t("Enable"),help:e.$t("Connection state"),readonly:e.$serial.validateServices(e.formOptions().status,n,"DLMS")&&n.enabled==="0"}}),n.connections_type==="1"&&e.noDevice?t("tlt-inline-message",{attrs:{id:"device-not-available",type:"warning",message:e.$serial.returnDisconnectedDeviceError(e.initialDevice)}}):e._e(),e.$serial.validateServices(e.formOptions().status,n,"DLMS")&&n.enabled==="0"?t("tlt-inline-message",{attrs:{id:"device-service-enabled",type:"warning"}},[e._v(" "+e._s(e.$t("Device is already enabled in %s service, disable it").format(e.usedDevice.service))+" "),t("router-link",{attrs:{to:e.$serial.returnPath(e.usedDevice.service),"test-id":"device-service-enabled-link"}},[e._v(" "+e._s(e.$t("here"))+" ")])],1):e._e(),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("Name"),maxlength:"200",required:"",help:e.$t("Name of DLMS connection configuration"),name:"name"}}),t("vuci-form-item-select",{attrs:{"uci-section":n,label:e.$t("Connection type"),help:e.$t("DLMS connection type"),name:"connection_type",options:e.formOptions().connectionOptions}}),t("vuci-form-item-select",{attrs:{"uci-section":n,label:e.$t("Serial device"),help:e.$t("DLMS serial device"),name:"device",depend:n.connection_type==="1",options:e.formOptions().device}}),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("IP address"),help:e.$t("DLMS device IP address for TCP connection"),name:"address",required:"",rules:["ipaddr",e.validateGroup],depend:n.connection_type==="0"},on:{change:e.updateValidations}}),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("Port"),help:e.$t("DLMS device IP port for TCP connection"),name:"port",required:"",rules:["port",e.validateGroup],depend:n.connection_type==="0"},on:{change:e.updateValidations}}),t("vuci-form-item-switch",{attrs:{"uci-section":n,label:e.$t("Persistent"),help:e.$t("Open TCP connection once and reuse it between requests"),name:"persistent",depend:n.connection_type==="0"}}),t("vuci-form-item-select",{attrs:{"uci-section":n,label:e.$t("Baud rate"),help:e.$t("Select supported baud rate"),name:"baudrate",options:e.serialOptions.baudRate,initial:"9600",depend:n.connection_type==="1"}}),t("vuci-form-item-select",{attrs:{"uci-section":n,label:e.$t("Data bits"),help:e.$t("Select how many bits will be used for character"),name:"databits",options:e.serialOptions.dataBits,initial:"8",depend:n.connection_type==="1"}}),t("vuci-form-item-select",{attrs:{"uci-section":n,label:e.$t("Stop bits"),help:e.$t("Select how many stop bits will be used to detect the end of character"),name:"stopbits",options:e.serialOptions.stopBits,initial:"1",depend:n.connection_type==="1"}}),t("vuci-form-item-select",{attrs:{"uci-section":n,label:e.$t("Parity"),help:e.$t("Select what kind of parity bit to use for error detection"),name:"parity",initial:"none",options:e.serialOptions.parity,depend:n.connection_type==="1"}}),t("vuci-form-item-select",{attrs:{"uci-section":n,label:e.$t("Flow control"),help:e.$t("Select what kind of characters to use for flow control"),name:"flowcontrol",initial:"none",options:e.serialOptions.flowControl,depend:n.connection_type==="1"}}),t("vuci-form-item-switch",{attrs:{"uci-section":n,label:e.$t("Full Duplex"),help:e.$t("Check to enable %s Full-Duplex").format(n.bus),name:"full_duplex_enabled",depend:n.connection_type==="1"&&n.device==="/dev/rs485"}})]}}],null,!0)})]}}]),model:{value:e.formData,callback:function(s){e.formData=s},expression:"formData"}})},ne=[],se=g(te,ie,ne,!1,null,null,null,null);const oe=se.exports,re={inject:["form"],methods:{afterSave(i,e){this.form().globalStatus=e.data.enabled==="1"}}};var ae=function(){var e=this,t=e._self._c;return t("vuci-form",{attrs:{editing:"",config:"dlms_client"},scopedSlots:e._u([{key:"default",fn:function({uciData:s}){return[t("vuci-named-section",{attrs:{name:"globals",title:e.$t("DLMS Global Settings"),"uci-data":s,endpoints:[{endpoint:"dlms/global"}],"data-key":"global","after-save":e.afterSave},scopedSlots:e._u([{key:"default",fn:function({s:n}){return[t("vuci-form-item-switch",{attrs:{"uci-section":n,name:"enabled",label:e.$t("Enabled"),initial:"0",help:e.$t("Turn on/off DLMS service")}})]}}],null,!0)})]}}])})},ce=[],le=g(re,ae,ce,!1,null,null,null,null);const ue=le.exports;/*!
 * vuex v3.6.2
 * (c) 2021 Evan You
 * @license MIT
 */function de(i){var e=Number(i.version.split(".")[0]);if(e>=2)i.mixin({beforeCreate:s});else{var t=i.prototype._init;i.prototype._init=function(n){n===void 0&&(n={}),n.init=n.init?[s].concat(n.init):s,t.call(this,n)}}function s(){var n=this.$options;n.store?this.$store=typeof n.store=="function"?n.store():n.store:n.parent&&n.parent.$store&&(this.$store=n.parent.$store)}}var fe=typeof window<"u"?window:typeof global<"u"?global:{},y=fe.__VUE_DEVTOOLS_GLOBAL_HOOK__;function he(i){y&&(i._devtoolHook=y,y.emit("vuex:init",i),y.on("vuex:travel-to-state",function(e){i.replaceState(e)}),i.subscribe(function(e,t){y.emit("vuex:mutation",e,t)},{prepend:!0}),i.subscribeAction(function(e,t){y.emit("vuex:action",e,t)},{prepend:!0}))}function _(i,e){Object.keys(i).forEach(function(t){return e(i[t],t)})}function x(i){return i!==null&&typeof i=="object"}function me(i){return i&&typeof i.then=="function"}function p(i,e){if(!i)throw new Error("[vuex] "+e)}function pe(i,e){return function(){return i(e)}}var b=function(e,t){this.runtime=t,this._children=Object.create(null),this._rawModule=e;var s=e.state;this.state=(typeof s=="function"?s():s)||{}},T={namespaced:{configurable:!0}};T.namespaced.get=function(){return!!this._rawModule.namespaced},b.prototype.addChild=function(e,t){this._children[e]=t},b.prototype.removeChild=function(e){delete this._children[e]},b.prototype.getChild=function(e){return this._children[e]},b.prototype.hasChild=function(e){return e in this._children},b.prototype.update=function(e){this._rawModule.namespaced=e.namespaced,e.actions&&(this._rawModule.actions=e.actions),e.mutations&&(this._rawModule.mutations=e.mutations),e.getters&&(this._rawModule.getters=e.getters)},b.prototype.forEachChild=function(e){_(this._children,e)},b.prototype.forEachGetter=function(e){this._rawModule.getters&&_(this._rawModule.getters,e)},b.prototype.forEachAction=function(e){this._rawModule.actions&&_(this._rawModule.actions,e)},b.prototype.forEachMutation=function(e){this._rawModule.mutations&&_(this._rawModule.mutations,e)},Object.defineProperties(b.prototype,T);var $=function(e){this.register([],e,!1)};$.prototype.get=function(e){return e.reduce(function(t,s){return t.getChild(s)},this.root)},$.prototype.getNamespace=function(e){var t=this.root;return e.reduce(function(s,n){return t=t.getChild(n),s+(t.namespaced?n+"/":"")},"")},$.prototype.update=function(e){k([],this.root,e)},$.prototype.register=function(e,t,s){var n=this;s===void 0&&(s=!0),process.env.NODE_ENV!=="production"&&L(e,t);var o=new b(t,s);if(e.length===0)this.root=o;else{var a=this.get(e.slice(0,-1));a.addChild(e[e.length-1],o)}t.modules&&_(t.modules,function(c,r){n.register(e.concat(r),c,s)})},$.prototype.unregister=function(e){var t=this.get(e.slice(0,-1)),s=e[e.length-1],n=t.getChild(s);if(!n){process.env.NODE_ENV!=="production"&&console.warn("[vuex] trying to unregister module '"+s+"', which is not registered");return}n.runtime&&t.removeChild(s)},$.prototype.isRegistered=function(e){var t=this.get(e.slice(0,-1)),s=e[e.length-1];return t?t.hasChild(s):!1};function k(i,e,t){if(process.env.NODE_ENV!=="production"&&L(i,t),e.update(t),t.modules)for(var s in t.modules){if(!e.getChild(s)){process.env.NODE_ENV!=="production"&&console.warn("[vuex] trying to add a new module '"+s+"' on hot reloading, manual reload is needed");return}k(i.concat(s),e.getChild(s),t.modules[s])}}var I={assert:function(i){return typeof i=="function"},expected:"function"},ve={assert:function(i){return typeof i=="function"||typeof i=="object"&&typeof i.handler=="function"},expected:'function or object with "handler" function'},A={getters:I,mutations:I,actions:ve};function L(i,e){Object.keys(A).forEach(function(t){if(e[t]){var s=A[t];_(e[t],function(n,o){p(s.assert(n),be(i,t,o,n,s.expected))})}})}function be(i,e,t,s,n){var o=e+" should be "+n+' but "'+e+"."+t+'"';return i.length>0&&(o+=' in module "'+i.join(".")+'"'),o+=" is "+JSON.stringify(s)+".",o}var m,v=function i(e){var t=this;e===void 0&&(e={}),!m&&typeof window<"u"&&window.Vue&&Se(window.Vue),process.env.NODE_ENV!=="production"&&(p(m,"must call Vue.use(Vuex) before creating a store instance."),p(typeof Promise<"u","vuex requires a Promise polyfill in this browser."),p(this instanceof i,"store must be called with the new operator."));var s=e.plugins;s===void 0&&(s=[]);var n=e.strict;n===void 0&&(n=!1),this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new $(e),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._watcherVM=new m,this._makeLocalGettersCache=Object.create(null);var o=this,a=this,c=a.dispatch,r=a.commit;this.dispatch=function(f,h){return c.call(o,f,h)},this.commit=function(f,h,C){return r.call(o,f,h,C)},this.strict=n;var l=this._modules.root.state;E(this,l,[],this._modules.root),w(this,l),s.forEach(function(u){return u(t)});var d=e.devtools!==void 0?e.devtools:m.config.devtools;d&&he(this)},O={state:{configurable:!0}};O.state.get=function(){return this._vm._data.$$state},O.state.set=function(i){process.env.NODE_ENV!=="production"&&p(!1,"use store.replaceState() to explicit replace store state.")},v.prototype.commit=function(e,t,s){var n=this,o=S(e,t,s),a=o.type,c=o.payload,r=o.options,l={type:a,payload:c},d=this._mutations[a];if(!d){process.env.NODE_ENV!=="production"&&console.error("[vuex] unknown mutation type: "+a);return}this._withCommit(function(){d.forEach(function(f){f(c)})}),this._subscribers.slice().forEach(function(u){return u(l,n.state)}),process.env.NODE_ENV!=="production"&&r&&r.silent&&console.warn("[vuex] mutation type: "+a+". Silent option has been removed. Use the filter functionality in the vue-devtools")},v.prototype.dispatch=function(e,t){var s=this,n=S(e,t),o=n.type,a=n.payload,c={type:o,payload:a},r=this._actions[o];if(!r){process.env.NODE_ENV!=="production"&&console.error("[vuex] unknown action type: "+o);return}try{this._actionSubscribers.slice().filter(function(d){return d.before}).forEach(function(d){return d.before(c,s.state)})}catch(d){process.env.NODE_ENV!=="production"&&(console.warn("[vuex] error in before action subscribers: "),console.error(d))}var l=r.length>1?Promise.all(r.map(function(d){return d(a)})):r[0](a);return new Promise(function(d,u){l.then(function(f){try{s._actionSubscribers.filter(function(h){return h.after}).forEach(function(h){return h.after(c,s.state)})}catch(h){process.env.NODE_ENV!=="production"&&(console.warn("[vuex] error in after action subscribers: "),console.error(h))}d(f)},function(f){try{s._actionSubscribers.filter(function(h){return h.error}).forEach(function(h){return h.error(c,s.state,f)})}catch(h){process.env.NODE_ENV!=="production"&&(console.warn("[vuex] error in error action subscribers: "),console.error(h))}u(f)})})},v.prototype.subscribe=function(e,t){return V(e,this._subscribers,t)},v.prototype.subscribeAction=function(e,t){var s=typeof e=="function"?{before:e}:e;return V(s,this._actionSubscribers,t)},v.prototype.watch=function(e,t,s){var n=this;return process.env.NODE_ENV!=="production"&&p(typeof e=="function","store.watch only accepts a function."),this._watcherVM.$watch(function(){return e(n.state,n.getters)},t,s)},v.prototype.replaceState=function(e){var t=this;this._withCommit(function(){t._vm._data.$$state=e})},v.prototype.registerModule=function(e,t,s){s===void 0&&(s={}),typeof e=="string"&&(e=[e]),process.env.NODE_ENV!=="production"&&(p(Array.isArray(e),"module path must be a string or an Array."),p(e.length>0,"cannot register the root module by using registerModule.")),this._modules.register(e,t),E(this,this.state,e,this._modules.get(e),s.preserveState),w(this,this.state)},v.prototype.unregisterModule=function(e){var t=this;typeof e=="string"&&(e=[e]),process.env.NODE_ENV!=="production"&&p(Array.isArray(e),"module path must be a string or an Array."),this._modules.unregister(e),this._withCommit(function(){var s=M(t.state,e.slice(0,-1));m.delete(s,e[e.length-1])}),P(this)},v.prototype.hasModule=function(e){return typeof e=="string"&&(e=[e]),process.env.NODE_ENV!=="production"&&p(Array.isArray(e),"module path must be a string or an Array."),this._modules.isRegistered(e)},v.prototype.hotUpdate=function(e){this._modules.update(e),P(this,!0)},v.prototype._withCommit=function(e){var t=this._committing;this._committing=!0,e(),this._committing=t},Object.defineProperties(v.prototype,O);function V(i,e,t){return e.indexOf(i)<0&&(t&&t.prepend?e.unshift(i):e.push(i)),function(){var s=e.indexOf(i);s>-1&&e.splice(s,1)}}function P(i,e){i._actions=Object.create(null),i._mutations=Object.create(null),i._wrappedGetters=Object.create(null),i._modulesNamespaceMap=Object.create(null);var t=i.state;E(i,t,[],i._modules.root,!0),w(i,t,e)}function w(i,e,t){var s=i._vm;i.getters={},i._makeLocalGettersCache=Object.create(null);var n=i._wrappedGetters,o={};_(n,function(c,r){o[r]=pe(c,i),Object.defineProperty(i.getters,r,{get:function(){return i._vm[r]},enumerable:!0})});var a=m.config.silent;m.config.silent=!0,i._vm=new m({data:{$$state:e},computed:o}),m.config.silent=a,i.strict&&Ee(i),s&&(t&&i._withCommit(function(){s._data.$$state=null}),m.nextTick(function(){return s.$destroy()}))}function E(i,e,t,s,n){var o=!t.length,a=i._modules.getNamespace(t);if(s.namespaced&&(i._modulesNamespaceMap[a]&&process.env.NODE_ENV!=="production"&&console.error("[vuex] duplicate namespace "+a+" for the namespaced module "+t.join("/")),i._modulesNamespaceMap[a]=s),!o&&!n){var c=M(e,t.slice(0,-1)),r=t[t.length-1];i._withCommit(function(){process.env.NODE_ENV!=="production"&&r in c&&console.warn('[vuex] state field "'+r+'" was overridden by a module with the same name at "'+t.join(".")+'"'),m.set(c,r,s.state)})}var l=s.context=ge(i,a,t);s.forEachMutation(function(d,u){var f=a+u;$e(i,f,d,l)}),s.forEachAction(function(d,u){var f=d.root?u:a+u,h=d.handler||d;ye(i,f,h,l)}),s.forEachGetter(function(d,u){var f=a+u;De(i,f,d,l)}),s.forEachChild(function(d,u){E(i,e,t.concat(u),d,n)})}function ge(i,e,t){var s=e==="",n={dispatch:s?i.dispatch:function(o,a,c){var r=S(o,a,c),l=r.payload,d=r.options,u=r.type;if((!d||!d.root)&&(u=e+u,process.env.NODE_ENV!=="production"&&!i._actions[u])){console.error("[vuex] unknown local action type: "+r.type+", global type: "+u);return}return i.dispatch(u,l)},commit:s?i.commit:function(o,a,c){var r=S(o,a,c),l=r.payload,d=r.options,u=r.type;if((!d||!d.root)&&(u=e+u,process.env.NODE_ENV!=="production"&&!i._mutations[u])){console.error("[vuex] unknown local mutation type: "+r.type+", global type: "+u);return}i.commit(u,l,d)}};return Object.defineProperties(n,{getters:{get:s?function(){return i.getters}:function(){return _e(i,e)}},state:{get:function(){return M(i.state,t)}}}),n}function _e(i,e){if(!i._makeLocalGettersCache[e]){var t={},s=e.length;Object.keys(i.getters).forEach(function(n){if(n.slice(0,s)===e){var o=n.slice(s);Object.defineProperty(t,o,{get:function(){return i.getters[n]},enumerable:!0})}}),i._makeLocalGettersCache[e]=t}return i._makeLocalGettersCache[e]}function $e(i,e,t,s){var n=i._mutations[e]||(i._mutations[e]=[]);n.push(function(a){t.call(i,s.state,a)})}function ye(i,e,t,s){var n=i._actions[e]||(i._actions[e]=[]);n.push(function(a){var c=t.call(i,{dispatch:s.dispatch,commit:s.commit,getters:s.getters,state:s.state,rootGetters:i.getters,rootState:i.state},a);return me(c)||(c=Promise.resolve(c)),i._devtoolHook?c.catch(function(r){throw i._devtoolHook.emit("vuex:error",r),r}):c})}function De(i,e,t,s){if(i._wrappedGetters[e]){process.env.NODE_ENV!=="production"&&console.error("[vuex] duplicate getter key: "+e);return}i._wrappedGetters[e]=function(o){return t(s.state,s.getters,o.state,o.getters)}}function Ee(i){i._vm.$watch(function(){return this._data.$$state},function(){process.env.NODE_ENV!=="production"&&p(i._committing,"do not mutate vuex store state outside mutation handlers.")},{deep:!0,sync:!0})}function M(i,e){return e.reduce(function(t,s){return t[s]},i)}function S(i,e,t){return x(i)&&i.type&&(t=e,e=i,i=i.type),process.env.NODE_ENV!=="production"&&p(typeof i=="string","expects string as the type, but found "+typeof i+"."),{type:i,payload:e,options:t}}function Se(i){if(m&&i===m){process.env.NODE_ENV!=="production"&&console.error("[vuex] already installed. Vue.use(Vuex) should be called only once.");return}m=i,de(m)}var Ce=we(function(i,e){var t={};return process.env.NODE_ENV!=="production"&&!R(e)&&console.error("[vuex] mapGetters: mapper parameter must be either an Array or an Object"),Oe(e).forEach(function(s){var n=s.key,o=s.val;o=i+o,t[n]=function(){if(!(i&&!Me(this.$store,"mapGetters",i))){if(process.env.NODE_ENV!=="production"&&!(o in this.$store.getters)){console.error("[vuex] unknown getter: "+o);return}return this.$store.getters[o]}},t[n].vuex=!0}),t});function Oe(i){return R(i)?Array.isArray(i)?i.map(function(e){return{key:e,val:e}}):Object.keys(i).map(function(e){return{key:e,val:i[e]}}):[]}function R(i){return Array.isArray(i)||x(i)}function we(i){return function(e,t){return typeof e!="string"?(t=e,e=""):e.charAt(e.length-1)!=="/"&&(e+="/"),i(e,t)}}function Me(i,e,t){var s=i._modulesNamespaceMap[t];return process.env.NODE_ENV!=="production"&&!s&&console.error("[vuex] module namespace not found in "+e+"(): "+t),s}const Ne={provide(){return{formOptions:()=>this.formOptions,form:()=>this.globalEnabled}},data(){return{tabs:[{tab:"devices",title:this.$t("Main")},{tab:"connections",title:this.$t("Connections")}],connection:"",currentValue:"",tempVal:"",formData:{},connectionColumns:[{name:"name",label:this.$t("Name"),help:this.$t("DLMS connection name.")},{name:"bus",label:this.$t("Address/Device"),help:this.$t("DLMS connection TCP address or serial device.")},{name:"devices",label:this.$t("Enabled devices"),help:this.$t("Connection is active when there are enabled devices assigned to it.")},{name:"enabled",label:this.$t("Enable"),help:this.$t("DLMS connection enable switch.")}],cosemGroupColumns:[{name:"name",label:this.$t("Name"),help:this.$t("DLMS COSEM group name.")},{name:"enabled",label:this.$t("Enable"),help:this.$t("DLMS COSEM group enable switch.")},{name:"test",label:this.$t("Test"),help:this.$t("COSEM group configuration test button.")}],physicalDeviceColumns:[{name:"name",label:this.$t("Name"),help:this.$t("Physical device name.")},{name:"enabled",label:this.$t("Enable"),help:this.$t("Physical device enable switch.")},{name:"test",label:this.$t("Test"),help:this.$t("Physical device configuration test button.")}],formOptions:{serial:[],device:[],status:[],connectionOptions:[]},editModal:ee,cosemEdit:W,connectionModal:oe,dlmsGlobal:ue,testDisabled:!1,redirect:!1,redirectToTab:{value:void 0,currentValue:void 0},redirectToDevice:void 0,closeModal:!1,globalEnabled:{globalStatus:"firstLoad"},stateChanged:!1,infoMessage:this.$t("%s service is disabled, navigate to global settings configuration to enable it.").format("DLMS")}},computed:{...Ce(["modalOpen"]),devices(){return this.$serial.filterDevices(this.formOptions.serial)},getFormOptions(){return this.formOptions}},watch:{"globalEnabled.globalStatus":function(i,e){e==="firstLoad"?i||this.$alert.info(this.infoMessage):this.stateChanged=!0},modalOpen(i){!i&&this.stateChanged&&(this.stateChanged=!1,this.globalEnabled.globalStatus?this.$alert.remove(this.infoMessage):this.$alert.info(this.infoMessage))},redirect(i){i&&this.$nextTick(()=>{this.$refs.devices._closeEdit(this.formData),this.switchToConnection(this.redirectToTab.value,this.redirectToTab.currentValue)})},redirectToDevice(i){this.$nextTick(()=>{this.$refs.connections._closeEdit(this.formData),this.switchToDevice(this.redirectToDevice)})},closeModal(i){i&&this.$nextTick(()=>{this.$refs.connections.reloadData(),this.closeModal=!1})}},async created(){this.$bus.on("redirect-to-tab",(i,e)=>{this.redirect=!0,this.redirectToTab.value=i,this.redirectToTab.currentValue=e}),this.$bus.on("redirect-to-device",i=>{this.redirectToDevice=i}),this.$bus.on("clear-values",()=>{this.redirect=!1,this.tempVal=""}),this.$bus.on("close-modal",()=>{this.closeModal=!0})},methods:{switchToConnection(i,e){this.tempVal=e,this.$refs.tabs._changeTab({tab:this.tabs[1].tab}),this.formData.connection.some(t=>t.id===i)?this.$refs.connections._openEdit(i):(this.formData.connection.push({id:i}),this.$refs.connections._openEdit(i))},switchToDevice(i){this.formData.connection.forEach((e,t)=>{e.id===i.data.id&&(this.formData.connection[t]=i.data)}),this.tempVal&&(this.$refs.tabs._changeTab({tab:this.tabs[0].tab}),this.$refs.devices._openEdit(this.tempVal))},loadDevices(i,e){return this.formData.device.filter(t=>t.connection===e.uciSection.id&&t.enabled==="1").length},getAddressString(i,e){if(i==="0"){const t=e.uciSection.address;if(!t)return this.$t("N/A");const s=e.uciSection.port;if(!s)return this.$t("N/A");if(N(t))return`${t}:${s}`;if(Y(t))return`[${t}]:${s}`}else if(i==="1"){const t=e.uciSection.device;if(!t)return this.$t("N/A");const n=this.formOptions.device.find(a=>a[0]===t);return n?n[1]:this.$t("N/A")}return this.$t("N/A")},devicesExist(i){const e=this.formData.cosem_group.flatMap(t=>{var s;return(s=this.formData[`${t.id}_cosem`])==null?void 0:s.flatMap(n=>n.physical_device)});return this.formData.device.some(t=>t.connection===i&&e.includes(t.id))},isConnectionEnableSwitchEnabled(i){if(!this.isConnectionSerial(i)||i.enabled==="1")return!0;const e=this.$serial.checkForExternalDevice(this.devices,i),t=this.$serial.validateServices(this.formOptions.status,i,"DLMS");return!(e||t)},connectionEnableSwitchHints(i){return this.isConnectionEnableSwitchEnabled(i)?[]:[{info:this.$serial.filterError(this.formOptions.status,i,this.devices)}]},multiBulkGet(i){const e=[];for(let t=0;t<i.length;t+=100)e.push(this.$axios.bulkGet(i.slice(t,t+100)));return Promise.all(e).then(t=>t.flat())},loadData(i){const e=i.cosem_group.map(s=>`/api/dlms/cosem_group/${s.id}/cosem/config`),t=["/api/system/device/status",{endpoint:"/api/serial/status",condition:this.$store.getters.hasPackages("vuci-app-getty-ui")},"/api/dlms/connections/config","/api/dlms/global",...e];return this.multiBulkGet(t).then(s=>{const n=s.shift(),o=s.shift(),a=s.shift(),c=s.shift();c.success?this.globalEnabled.globalStatus=c.data.enabled==="1":this.$message.error(this.$t("Failed to load DLMS global data")),this.formOptions.serial=n.success&&n.data.board.serial?n.data.board.serial:[],this.formOptions.device=this.devices,this.formOptions.status=o.success?o.data:[];const r=[["0","TCP"]];this.formOptions.connectionOptions=this.devices.length?r.concat([["1",this.$t("Serial")]]):r,n.success||this.$message.error(this.$t("Failed to load serial data")),o.success||this.$message.error(this.$t("Failed to load rs serial status")),a.success||this.$message.error(this.$t("Failed to load connection data"));const l={};return s.forEach((d,u)=>{const f=i.cosem_group[u].id;d.success?l[`${f}_cosem`]=d.data:this.$message.error(this.$t("Failed to load COSEM data for %s COSEM group.").format(f))}),l}).catch(()=>{this.$message.error(this.$t("An unexpected error occurred"))})},testDevice(i){return i.vuciForm.validate().then(e=>{if(!e)throw new Error("invalid");const t=i.uciSection;if(!t.connection)throw new Error("connection");const s=this.formData.connection.find(l=>l.id===t.connection);if(!s.connection_type)throw new Error("noSection");const n=[],o={},a=["client_addr","server_addr","log_server_addr"];let c=["connection_type"];if(s.connection_type==="0"&&(c=c.concat(["address","port"])),s.connection_type==="1"&&(c=c.concat(["device","baudrate","databits","stopbits","parity","flowcontrol"])),a.forEach(l=>{o[l]=t[l]||n.push(l)}),c.forEach(l=>{o[l]=s[l]}),["transport_security","interface","access_security","password","authentication_key","block_cipher_key","dedicated_key","invocation_counter","use_ln_ref"].forEach(l=>{t[l]&&(o[l]=t[l])}),n.length!==0)throw new Error("missingValues",{cause:n});return this.testDisabled=!0,this.$axios.post("/api/dlms/devices/actions/test",{data:o})}).then(({data:e})=>{if(e&&!e.error)return this.$message.success(this.$t("Configuration test succeeded"));if(e&&e.error&&e.result){if(e.result.includes("connection"))return this.$message.error(this.$t("Failed to make connection with device"));if(e.result.includes("parameters"))return this.$message.error(this.$t("Failed to parse device parameters"))}return this.$message.error(this.$t("Configuration test failed"))}).catch(e=>{const t={missingValues:this.$t("Some values are missing (%s)"),noSection:this.$t("Connection type is missing"),invalid:this.$t("Values used for testing are invalid"),connection:this.$t("Connection is missing")};if(e&&e.message&&t[e.message]&&e.cause)return this.$message.error(t[e.message].format(e.cause.toString()));if(e&&e.message&&t[e.message])return this.$message.error(t[e.message]);this.$message.error(this.$t("Failed to test request, encountered an unexpected error."))}).finally(()=>{this.testDisabled=!1})},onCosemAdd(i,e){return e.length>=10?{valid:!1,message:this.$t("Maximum number of COSEM groups has been reached")}:{valid:!0}},onConnectionAdd(i,e){return e.length>=30?{valid:!1,message:this.$t("Maximum number of connections has been reached")}:{valid:!0}},cosemExist(i){return this.formData.cosem_group.flatMap(t=>{var s;return(s=this.formData[`${t.id}_cosem`])==null?void 0:s.flatMap(n=>n.physical_device)}).includes(i)},addValidate(i,e){return e.some(s=>s.name===i.name)?{isValid:!1,message:this.$t("Device with %s name already exists").format(i.name)}:e.length<30?{valid:!0}:{valid:!1,message:this.$t("Maximum number of physical devices has been reached")}},test(i){const e=this.$t("There are no enabled objects in the tested group");if(!this.formData[`${i.id}_cosem`])return this.$message.error(e);const t=structuredClone(this.formData[`${i.id}_cosem`].filter(n=>n.enabled==="1"));if(!t.length)return this.$message.error(e);let s="";if(t.forEach(n=>{(!n.physical_device||!n.cosem_id||!n.obis)&&(s=n.name||this.$t("Undefined")),n.devices=n.physical_device,delete n.physical_device,delete n._md5,delete n[".type"]}),s){this.$message.error(this.$t("%s COSEM object parameters are missing, double check your configuration").format(s));return}return this.testDisabled=!0,this.$axios.post("/api/dlms/cosem_group/actions/test",{data:{object:t}}).then(({data:n})=>n&&!n.error?this.$message.success(this.$t("Configuration test succeeded")):this.$message.error(this.$t("Configuration test failed"))).catch(n=>{var a,c,r,l;const o={invalid:this.$t("Values used for testing are invalid")};if(n&&n.message&&o[n.message])return this.$message.error(o[n.message]);if(((l=(r=(c=(a=n.response)==null?void 0:a.data)==null?void 0:c.errors)==null?void 0:r[0])==null?void 0:l.code)===16)return this.$message.error(this.$t("There are no enabled connections, please enable a connection before using COSEM groups"));this.$message.error(this.$t("Failed to test request, encountered an unexpected error."))}).finally(()=>{this.testDisabled=!1})},returnDeleteHints(i,e){return i==="connection"?this.devicesExist(e)?[{info:this.$t("This instance can't be deleted because devices belonging to it are used in COSEM configuration")}]:[]:this.cosemExist(e)?[{info:this.$t("This device cannot be deleted, it is used in COSEM configuration")}]:[]},removeChildren(i){delete this.formData[`${i.id}_cosem`]},removeDevices(i){delete this.formData[`${i.id}_device`]},validateCosemEnable(i){var e;i.model==="0"||!i.model||(e=this.formData[`${i.uciSection.id}_cosem`])!=null&&e.some(t=>t.enabled==="1")||(i.model="0",this.$message.error(this.$t("To enable COSEM group at least one COSEM value needs to be enabled.")))},isConnectionSerial(i){return i.connection_type==="1"}}};var xe=function(){var e=this,t=e._self._c;return t("vuci-form",{attrs:{config:"dlms_client","after-load":e.loadData},scopedSlots:e._u([{key:"default",fn:function({uciData:s}){return[t("tlt-tabs",{ref:"tabs",staticClass:"pt-16 pb-4 px-5",attrs:{tabs:e.tabs,row:""},on:{"tab-change":n=>e.name=n},scopedSlots:e._u([{key:"devices",fn:function(){return[t("div",{staticClass:"-mt-[49px]"},[t("vuci-typed-section",{ref:"devices",staticClass:"mb-16",attrs:{type:"physical_device",title:e.$t("DLMS Physical Devices"),columns:e.physicalDeviceColumns,"uci-data":s,"edit-form":e.editModal,endpoints:[{endpoint:"dlms/devices/config"}],"data-key":"device","add-validate":e.addValidate,"add-title":e.$t("Add new physical device"),"global-settings-form":e.dlmsGlobal},scopedSlots:e._u([{key:"enabled",fn:function({s:n}){return[t("vuci-form-item-switch",{attrs:{"uci-section":n,name:"enabled"}})]}},{key:"test",fn:function({s:n}){return[t("vuci-form-item-button",{attrs:{"uci-section":n,name:"test",text:e.$t("Test"),readonly:e.testDisabled},on:{click:e.testDevice}})]}},{key:"deleteBtn",fn:function({s:n,actions:o}){return[t("tlt-hint",{class:{"read-only-button-padding":e.cosemExist(n.id)},attrs:{hints:e.returnDeleteHints("device",n.id),"align-right":""}},[t("tlt-button",{staticClass:"mr-1",attrs:{"test-id":"button-delete",readonly:e.cosemExist(n.id),type:"text",color:"error"},on:{click:function(a){return o.delete(n.id)}}},[e._v(e._s(e.$t("Delete")))])],1)]}}],null,!0)}),t("vuci-typed-section",{attrs:{type:"cosem_group",title:e.$t("DLMS COSEM Groups"),columns:e.cosemGroupColumns,"uci-data":s,"edit-form":e.cosemEdit,endpoints:[{endpoint:"dlms/cosem_group/config"}],"data-key":"cosem_group","add-validate":e.onCosemAdd,"add-title":e.$t("Add new COSEM group"),"after-delete":e.removeChildren},scopedSlots:e._u([{key:"enabled",fn:function({s:n}){return[t("vuci-form-item-switch",{attrs:{"uci-section":n,name:"enabled"},on:{change:e.validateCosemEnable}})]}},{key:"test",fn:function({s:n}){return[t("vuci-form-item-button",{attrs:{"uci-section":n,name:"test",text:e.$t("Test"),readonly:e.testDisabled},on:{click:function(o){return e.test(n)}}})]}}],null,!0)})],1)]},proxy:!0},{key:"connections",fn:function(){return[t("div",{staticClass:"-mt-[49px]"},[t("vuci-typed-section",{ref:"connections",staticClass:"mb-16",attrs:{type:"connection",title:e.$t("DLMS Connections"),help:e.$t("This section displays connection configuration instances. Connection is active when there are active devices assigned to it."),columns:e.connectionColumns,"edit-form":e.connectionModal,"add-validate":e.onConnectionAdd,"uci-data":s,endpoints:[{endpoint:"dlms/connections/config"}],"data-key":"connection","add-title":e.$t("Add new connection")},scopedSlots:e._u([{key:"bus",fn:function({s:n}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":n,name:"connection_type","display-value":e.getAddressString}})]}},{key:"devices",fn:function({s:n}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":n,name:"devices","display-value":e.loadDevices}})]}},{key:"deleteBtn",fn:function({s:n,actions:o}){return[t("tlt-hint",{class:{"read-only-button-padding":e.devicesExist(n.id)},attrs:{hints:e.returnDeleteHints("connection",n.id),"align-right":""}},[t("tlt-button",{staticClass:"mr-1",attrs:{"test-id":"button-delete",readonly:e.devicesExist(n.id),type:"text",color:"error"},on:{click:function(a){return o.delete(n.id)}}},[e._v(e._s(e.$t("Delete")))])],1)]}},{key:"enabled",fn:function({s:n}){return[t("tlt-hint",{attrs:{rawhtml:"",hints:e.connectionEnableSwitchHints(n)}},[t("vuci-form-item-switch",{attrs:{"uci-section":n,name:"enabled",readonly:!e.isConnectionEnableSwitchEnabled(n)}})],1)]}}],null,!0)})],1)]},proxy:!0}],null,!0)})]}},{key:"form-buttons",fn:function({save:s}){return[t("div",{staticClass:"save-button mr-5 mb-4"},[t("tlt-button",{attrs:{"button-id":"saveandapply"},on:{click:s}},[e._v(" "+e._s(e.$t("Save & Apply"))+" ")])],1)]}}]),model:{value:e.formData,callback:function(s){e.formData=s},expression:"formData"}})},Te=[],ke=g(Ne,xe,Te,!1,null,null,null,null);return ke.exports});
