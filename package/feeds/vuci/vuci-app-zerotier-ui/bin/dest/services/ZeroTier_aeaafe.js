(function(u,d){typeof exports=="object"&&typeof module<"u"?module.exports=d():typeof define=="function"&&define.amd?define(d):(u=typeof globalThis<"u"?globalThis:u||self,u["services/ZeroTier_js"]=d())})(this,function(){"use strict";function u(i,e,t,r,n,o,s,m){var a=typeof i=="function"?i.options:i;e&&(a.render=e,a.staticRenderFns=t,a._compiled=!0),r&&(a.functional=!0),o&&(a._scopeId="data-v-"+o);var c;if(s?(c=function(l){l=l||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!l&&typeof __VUE_SSR_CONTEXT__<"u"&&(l=__VUE_SSR_CONTEXT__),n&&n.call(this,l),l&&l._registeredComponents&&l._registeredComponents.add(s)},a._ssrRegister=c):n&&(c=m?function(){n.call(this,(a.functional?this.parent:this).$root.$options.shadowRoot)}:n),c)if(a.functional){a._injectStyles=c;var C=a.render;a.render=function(I,p){return c.call(p),C(I,p)}}else{var f=a.beforeCreate;a.beforeCreate=f?[].concat(f,c):[c]}return{exports:i,options:a}}const d={inject:["formOptions"],props:{section:{type:Object,required:!0}},data(){return{parent:this.section[".type"].substring(8),formData:{}}},computed:{mapBridgedNetworkOptions(){const i=[["none",this.$t("None")]],e=this.formOptions().interfaces.filter(t=>t[".type"]==="interface"&&t.bridge==="1");return i.concat(e.map(t=>[this.$network.getName(t),this.$network.getName(t).toUpperCase()]))}},methods:{validateNetwork(i){const e={isValid:!0,message:this.$t("Network ID cannot be the same between instance networks")},t=this.formData.zerotier_networks.filter(r=>r[".type"]===this.section[".type"]&&r.id!==this.section.id);return e.isValid=!t.some(r=>r.network_id===i),e},validatePort(i){const e={isValid:!0,message:this.$t("Port key cannot be the same between networks")},t=this.formData.zerotier_networks.filter(r=>r.id!==this.section.id);return e.isValid=!t.some(r=>r.port===i),e}}};var h=function(){var e=this,t=e._self._c;return t("vuci-form",{attrs:{editing:"",config:"zerotier"},scopedSlots:e._u([{key:"default",fn:function({uciData:r}){return[t("vuci-named-section",{attrs:{endpoints:[{endpoint:`zerotier/${e.parent}/networks/config`}],name:e.section.id,title:e.$t("ZeroTier Network: %s").format(e.section.name),"uci-data":r,"data-key":"zerotier_networks"},scopedSlots:e._u([{key:"default",fn:function({s:n}){return[t("vuci-form-item-switch",{attrs:{"uci-section":n,label:e.$t("Enable"),help:e.$t("Turn this network interface on/off"),name:"enabled"}}),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("Port"),name:"port",help:e.$t("Port for UDP and TCP/HTTP (default: 9993, 0 for random)"),rules:["port",e.validatePort],placeholder:"9993",initial:"9993",required:""}}),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("Network ID"),help:e.$t("A key peers need connecting to this interface"),name:"network_id",rules:["hexstring",e.validateNetwork],maxlength:"16",minlength:"16",required:""}}),t("vuci-form-item-select",{attrs:{"uci-section":n,name:"bridge_to",label:e.$t("Bridge to"),help:e.$t("Specify to which interface this zerotier instance should be bridged"),options:e.mapBridgedNetworkOptions,initial:"none"}}),t("vuci-form-item-switch",{attrs:{"uci-section":n,label:e.$t("Allow default route"),help:e.$t("Allows ZeroTier to override system default route"),name:"allow_default"}}),t("vuci-form-item-switch",{attrs:{"uci-section":n,label:e.$t("Allow global IP"),help:e.$t("Allows ZeroTier managed IPs and routes to overlap public IP space"),name:"allow_global"}}),t("vuci-form-item-switch",{attrs:{"uci-section":n,label:e.$t("Allow managed IP"),help:e.$t("Assigns ZeroTier managed IPs and routes"),name:"allow_managed",initial:"1"}}),t("vuci-form-item-switch",{attrs:{"uci-section":n,label:e.$t("Allow DNS"),help:e.$t("Applies DNS servers that are set at the network controller"),name:"allow_dns"}})]}}],null,!0)})]}}]),model:{value:e.formData,callback:function(r){e.formData=r},expression:"formData"}})},_=[],k=u(d,h,_,!1,null,null,null,null);const w=k.exports,$={data(){return{editModal:w,networksColumns:[{name:"name",label:this.$t("Network name")},{name:"network_id",label:this.$t("Network ID")},{name:"port",label:this.$t("Port")},{name:"enabled"}],formData:{}}},methods:{validateDuplicate(i){return this.formData.zerotier_networks.filter(t=>t.name===i).length===0?{isValid:!0}:{isValid:!1,message:this.$t("Name '%s' already exists").format(i)}},validateEnable(i){const e=i.uciSection;e.enabled==="1"&&!e.network_id&&(e.enabled="0",this.$message.error(this.$t('"Network ID" must be set to enable the network')))}}};var v=function(){var e=this,t=e._self._c;return t("vuci-form",{attrs:{config:"zerotier",editing:""},scopedSlots:e._u([{key:"default",fn:function({uciData:r,editableSection:n}){return[t("vuci-named-section",{attrs:{endpoints:[{endpoint:"zerotier/config"}],name:n.id,title:e.$t("Instance settings: %s").format(n.name),"uci-data":r,"data-key":"zerotier"},scopedSlots:e._u([{key:"default",fn:function({s:o}){return[t("vuci-form-item-switch",{attrs:{"uci-section":o,label:e.$t("Enable"),help:e.$t("Turn this zerotier interface on/off"),name:"enabled"}}),t("vuci-form-item-dummy",{attrs:{"uci-section":o,label:e.$t("Node ID"),help:e.$t("Router's unique ID for ZeroTier VPN"),name:"node_id","no-write":""}})]}}],null,!0)}),t("vuci-typed-section",{attrs:{type:"network_"+n.id,endpoints:[{endpoint:`zerotier/${n.id}/networks/config`}],"uci-data":r,title:e.$t("Network configuration"),help:e.$t("Here you can configure your network"),columns:e.networksColumns,"edit-form":e.editModal,"data-key":"zerotier_networks"},scopedSlots:e._u([{key:"name",fn:function({s:o}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":o,name:"name"}})]}},{key:"network_id",fn:function({s:o}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":o,name:"network_id",required:o.enabled!=="0"}})]}},{key:"port",fn:function({s:o}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":o,name:"port"}})]}},{key:"enabled",fn:function({s:o}){return[t("vuci-form-item-switch",{attrs:{"uci-section":o,name:"enabled"},on:{change:s=>e.validateEnable(s)}})]}},{key:"addForm",fn:function({addModel:o}){return[t("tlt-form-item-input",{attrs:{label:e.$t("Add new network"),prop:"name",required:"",placeholder:"Network name",maxlength:"32",rules:s=>[s.uciname,e.validateDuplicate]},model:{value:o.name,callback:function(s){e.$set(o,"name",s)},expression:"addModel.name"}})]}}],null,!0)})]}}]),model:{value:e.formData,callback:function(r){e.formData=r},expression:"formData"}})},b=[],g=u($,v,b,!1,null,null,null,null);const y=g.exports,D={provide(){return{formOptions:this.getFormOptions}},data(){return{editModal:y,formOptions:{interfaces:[]},deviceColumns:[{name:"name",label:this.$t("ZeroTier name"),help:this.$t("Name of the ZeroTier instance. Used for easier management purpose only")},{name:"node_id",label:this.$t("Instance node ID"),help:this.$t("Value is only available after a successful connection")},{name:"enabled"}],formData:{}}},methods:{validateDuplicate(i){return this.formData.zerotier.filter(t=>t.name===i).length===0?{isValid:!0}:{isValid:!1,message:this.$t("Name '%s' already exists").format(i)}},deleteNetworks(i,e){e.zerotier_networks=e.zerotier_networks.filter(t=>t[".type"]!==`network_${i.id}`)},getFormOptions(){return this.formOptions},loadData(i){const t=["/api/interfaces/config",...i.zerotier.map(r=>`/api/zerotier/${r.id}/networks/config`)];return this.$axios.bulkGet(t).then(([r,...n])=>(r.success||this.$message.error(this.$t("Failed to load interfaces")),this.formOptions.interfaces=r.success?r.data:[],{zerotier_networks:n.reduce((s,m,a)=>(m.success||(m.data=[],this.$message.error(this.$t("Failed to load %s instance").format(this.formData.zerotier[a].name))),s.concat(m.data)),[])||[]})).catch(()=>{this.$message.error(this.$t("An unexpected error occurred"))})}}};var N=function(){var e=this,t=e._self._c;return t("vuci-form",{attrs:{config:"zerotier","after-load":e.loadData},scopedSlots:e._u([{key:"default",fn:function({uciData:r}){return[t("vuci-typed-section",{attrs:{title:e.$t("ZeroTier Configuration"),columns:e.deviceColumns,type:"instance","uci-data":r,"edit-form":e.editModal,endpoints:[{endpoint:"zerotier/config"}],"data-key":"zerotier","after-delete":e.deleteNetworks,"restricted-values":["network_id"]},scopedSlots:e._u([{key:"name",fn:function({s:n}){return[t("vuci-form-item-dummy",{attrs:{name:"name","uci-section":n}})]}},{key:"node_id",fn:function({s:n}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":n,name:"node_id","no-write":""}})]}},{key:"enabled",fn:function({s:n}){return[t("vuci-form-item-switch",{attrs:{"uci-section":n,name:"enabled"}})]}},{key:"addForm",fn:function({addModel:n}){return[t("tlt-form-item-input",{attrs:{label:e.$t("New configuration name"),prop:"name",required:"",maxlength:"8",rules:o=>[o.uciname,e.validateDuplicate]},model:{value:n.name,callback:function(o){e.$set(n,"name",o)},expression:"addModel.name"}})]}}],null,!0)})]}}]),model:{value:e.formData,callback:function(r){e.formData=r},expression:"formData"}})},z=[],T=u(D,N,z,!1,null,null,null,null);return T.exports});
