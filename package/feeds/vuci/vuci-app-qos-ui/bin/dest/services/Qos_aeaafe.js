(function(l,c){typeof exports=="object"&&typeof module<"u"?module.exports=c():typeof define=="function"&&define.amd?define(c):(l=typeof globalThis<"u"?globalThis:l||self,l["services/Qos_js"]=c())})(this,function(){"use strict";function l(s,t,o,n,e,d,f,g){var i=typeof s=="function"?s.options:s;t&&(i.render=t,i.staticRenderFns=o,i._compiled=!0),n&&(i.functional=!0),d&&(i._scopeId="data-v-"+d);var r;if(f?(r=function(a){a=a||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!a&&typeof __VUE_SSR_CONTEXT__<"u"&&(a=__VUE_SSR_CONTEXT__),e&&e.call(this,a),a&&a._registeredComponents&&a._registeredComponents.add(f)},i._ssrRegister=r):e&&(r=g?function(){e.call(this,(i.functional?this.parent:this).$root.$options.shadowRoot)}:e),r)if(i.functional){i._injectStyles=r;var _=i.render;i.render=function(b,h){return r.call(h),_(b,h)}}else{var u=i.beforeCreate;i.beforeCreate=u?[].concat(u,r):[r]}return{exports:s,options:i}}const c={data(){return{interfacesColumns:[{name:"name",label:this.$t("Interface Name")},{name:"overhead",label:this.$t("Calculate overhead"),help:this.$t("Check to decrease upload and download ratio to prevent link saturation")},{name:"download",label:this.$t("Download speed (kbit/s)"),help:this.$t("Specify maximal download speed")},{name:"upload",label:this.$t("Upload speed (kbit/s)"),help:this.$t("Specify maximal upload speed")},{name:"enabled"}],classifyColumns:[{name:"target",label:this.$t("Target"),help:this.$t("Select target for which rule will be applied")},{name:"srchost",label:this.$t("Source host"),help:this.$t(`Packets matching this source host(s)
          (single IP or in CIDR notation) belong to the bucket
          defined in target`)},{name:"dsthost",label:this.$t("Destination host"),help:this.$t(`Packets matching this destination host(s)
          (single IP or in CIDR notation) belong to the
          bucket defined in the target`)},{name:"proto",label:this.$t("Protocol"),help:this.$t("Select data transmission protocol")},{name:"ports",label:this.$t("Ports"),help:this.$t("Select which ports will be used for transmission")}],targetOptions:[],interfaceData:[],hostData:[],protoOpts:[["",this.$t("All")],["tcp",this.$t("TCP")],["udp",this.$t("UDP")],["icmp",this.$t("ICMP")]],portOpts:[["",this.$t("All")]],offloadingData:{}}},computed:{interfaceOptions(){return this.interfaceData.filter(s=>s.id!=="loopback"&&["dhcp","static","wwan","connm"].includes(s.proto)).map(this.$network.getName)},hostOptions(){return[["",this.$t("All")],...this.hostData]}},watch:{offloadingData(s){(s==null?void 0:s.flow_offloading)==="1"&&this.$store.state.board.hwinfo.hw_nat&&this.$alert.info(this.$t('For %s to properly work "Software flow offloading" needs to be turned off on this device. This can be done in %s %s %s %s').format(this.$t("QoS"),"<a class=link href='/network/firewall/zones'>",this.$t("Firewall"),this.$t("General Settings"),"</a>"),!0)}},methods:{afterDelete(s,t,o){o.reloadData()},afterLoad(){const s=[{method:"GET",endpoint:"/api/interfaces/config"},{method:"GET",endpoint:"/api/qos/rules/options"},{method:"GET",endpoint:"/api/nat_offloading/global"}];return this.$axios.bulk(s).then(([t,o,n])=>(t.success?this.interfaceData=t.data:this.$message.error(this.$t("Failed to load network interfaces")),o.success?(this.hostData=o.data.ips,this.targetOptions=o.data.classes):this.$message.error(this.$t("Failed to load QoS rules")),n.success?this.offloadingData=n.data:this.$message.error(this.$t("Failed to load Nat offloading data")),{})).catch(()=>{this.$message.error(this.$t("An unexpected error occurred"))})},validatePorts(s){const t={isValid:!0},o={isValid:!1,message:this.$t(`Port range must be from 1 to 65535 and only positive integers.
        Ports must be separated by commas e.g. 20,30,40...`)};if(s.match(/^\d+$/))return Number(s)<1||Number(s)>65535?o:t;if(s.match(/^[,\d+]+$/)){for(const n of s.split(","))if(!n||Number(n)<1||Number(n)>65535)return o;return t}return o}}};var p=function(){var t=this,o=t._self._c;return o("vuci-form",{attrs:{config:"qos","after-load":t.afterLoad},scopedSlots:t._u([{key:"default",fn:function({uciData:n}){return[o("vuci-typed-section",{attrs:{"uci-data":n,"after-delete":t.afterDelete,"data-key":"qos",endpoints:[{endpoint:"qos/interfaces/config"}],type:"interface",title:t.$t("Interfaces"),help:t.$t("With QoS you can prioritize network      traffic selected by address, ports or services."),columns:t.interfacesColumns},scopedSlots:t._u([{key:"name",fn:function({s:e}){return[o("vuci-form-item-dummy",{attrs:{"uci-section":e,name:"name"}})]}},{key:"overhead",fn:function({s:e}){return[o("vuci-form-item-switch",{attrs:{"uci-section":e,name:"overhead"}})]}},{key:"download",fn:function({s:e}){return[o("vuci-form-item-input",{attrs:{"uci-section":e,name:"download",rules:"irange(100,4294967)"}})]}},{key:"upload",fn:function({s:e}){return[o("vuci-form-item-input",{attrs:{"uci-section":e,name:"upload",rules:"irange(100,4294967)"}})]}},{key:"enabled",fn:function({s:e}){return[o("vuci-form-item-switch",{attrs:{"uci-section":e,name:"enabled"}})]}},{key:"addForm",fn:function({addModel:e}){return[o("tlt-form-item-select",{attrs:{prop:"id",label:t.$t("Interface"),options:t.interfaceOptions},model:{value:e.id,callback:function(d){t.$set(e,"id",d)},expression:"addModel.id"}})]}}],null,!0)}),o("vuci-typed-section",{attrs:{"uci-data":n,"data-key":"classify",endpoints:[{endpoint:"qos/rules/config"}],type:"classify",title:t.$t("Classification Rules"),columns:t.classifyColumns,"after-delete":t.afterDelete},scopedSlots:t._u([{key:"target",fn:function({s:e}){return[o("vuci-form-item-select",{attrs:{"uci-section":e,name:"target",initial:"Normal",options:t.targetOptions}})]}},{key:"srchost",fn:function({s:e}){return[o("vuci-form-item-select",{attrs:{"uci-section":e,name:"srchost",rules:"ip4addr","allow-create":"",options:t.hostOptions}})]}},{key:"dsthost",fn:function({s:e}){return[o("vuci-form-item-select",{attrs:{"uci-section":e,name:"dsthost",rules:"ip4addr","allow-create":"",options:t.hostOptions}})]}},{key:"proto",fn:function({s:e}){return[o("vuci-form-item-select",{attrs:{"uci-section":e,name:"proto","allow-create":"",maxlenght:"16",options:t.protoOpts}})]}},{key:"ports",fn:function({s:e}){return[o("vuci-form-item-select",{attrs:{"uci-section":e,name:"ports",options:t.portOpts,rules:t.validatePorts,"allow-create":""}})]}}],null,!0)})]}}])})},m=[],$=l(c,p,m,!1,null,null,null,null);return $.exports});
