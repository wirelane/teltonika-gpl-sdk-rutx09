(function(u,m){typeof exports=="object"&&typeof module<"u"?module.exports=m():typeof define=="function"&&define.amd?define(m):(u=typeof globalThis<"u"?globalThis:u||self,u["services/DLNA_js"]=m())})(this,function(){"use strict";function u(s,t,e,n,i,d,a,l){var r=typeof s=="function"?s.options:s;t&&(r.render=t,r.staticRenderFns=e,r._compiled=!0),n&&(r.functional=!0),d&&(r._scopeId="data-v-"+d);var c;if(a?(c=function(o){o=o||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!o&&typeof __VUE_SSR_CONTEXT__<"u"&&(o=__VUE_SSR_CONTEXT__),i&&i.call(this,o),o&&o._registeredComponents&&o._registeredComponents.add(a)},r._ssrRegister=c):i&&(c=l?function(){i.call(this,(r.functional?this.parent:this).$root.$options.shadowRoot)}:i),c)if(r.functional){r._injectStyles=c;var v=r.render;r.render=function(y,h){return c.call(h),v(y,h)}}else{var f=r.beforeCreate;r.beforeCreate=f?[].concat(f,c):[c]}return{exports:s,options:r}}const m={data(){return{tabs:[{tab:"general",title:this.$t("General Settings")},{tab:"advanced",title:this.$t("Advanced Settings")}],loadedData:{wirelessStatus:[],interfaces:[],mounts:[],wirelessConfig:[],devices:[]},DLNAStatus:this.$t("Collecting data..."),interfaces:[],rootContainerOpts:[[".",this.$t("Standard Container")],["B",this.$t("Browse Directory")],["M",this.$t("Music")],["V",this.$t("Video")],["P",this.$t("Pictures")]]}},timers:{loadDLNAStatus:{time:5e3,autostart:!0,immediate:!0,repeat:!0}},computed:{mediaOptions(){return this.loadedData.mounts.map(t=>t.mountpoint).filter(t=>t).concat("/mnt")},ifaceOptions(){const s=["erspan0","qmimux","rmnet","wwan","radio"],e=this.loadedData.wirelessConfig.map(a=>[{network:a.network,excludedName:this.loadedData.wirelessStatus.find(l=>l.id===a.id).ifname}]).filter(a=>a&&this.loadedData.interfaces.some(l=>l.id===a[0].network&&l.bridge==="1")).map(a=>a[0].excludedName),n=this.loadedData.devices.filter(a=>(!a.virtual||a.type==="bridge")&&a.name!=="lo"),i=[...s,...e];return n.filter(a=>!i.some(l=>a.name.includes(l))).map(a=>a.network?[a.name,a.network]:[a.name,a.name])}},methods:{loadData(){const s=[{endpoint:"/api/wireless/interfaces/basic/status",condition:"wireless-regdb.control"},"/api/interfaces/config","/api/usb_tools/mount/options",{endpoint:"/api/wireless/interfaces/config",condition:"wireless-regdb.control"},"/api/network/devices/status"];return this.$axios.bulkGet(s).then(([t,e,n,i,d])=>{this.loadedData={wirelessStatus:t.success?t.data:[],interfaces:e.success?e.data:[],mounts:n.success?n.data:[],wirelessConfig:i.success?i.data:[],devices:d.success?d.data:[]},t.success||this.$message.error(this.$t("Failed to load wireless status")),e.success||this.$message.error(this.$t("Failed to load interfaces data")),n.success||this.$message.error(this.$t("Failed to load mounts data")),i.success||this.$message.error(this.$t("Failed to load wireless data")),d.success||this.$message.error(this.$t("Failed to load devices status"))}).catch(()=>{this.$message.error(this.$t("An unexpected error occurred"))})},getDLNAStatus(){return this.DLNAStatus},loadDLNAStatus(){return this.$axios.get("/api/minidlna/status").then(({data:s})=>{this.DLNAStatus=s.running?this.$t("The miniDLNA service is active, serving %d audio, %d video and %d image files").format(s.audio,s.video,s.images):this.$t("The miniDLNA service is not running")}).catch(()=>{this.$message.error(this.$t("Failed to get DLNA status"))})},albumValidation(s){const t=/(\/)/;return s.match(t)?{isValid:!1,message:this.$t("Character '/' is not allowed.")}:{isValid:!0}},handleError(s){const t=s.data.errors[0].code,e={103:this.$t("Media directory doesn't exist"),default:this.$t("Unexpected error occurred")};return e[t]||e.default}}};var p=function(){var t=this,e=t._self._c;return e("vuci-form",{attrs:{config:"minidlna,network","after-load":t.loadData},scopedSlots:t._u([{key:"default",fn:function({uciData:n}){return[e("vuci-named-section",{attrs:{"uci-data":n,title:t.$t("DLNA Settings"),help:t.$t("MiniDLNA is server software with the aim of being fully compliant with DLNA/UPnP-AV clients"),endpoints:[{endpoint:"minidlna/config"}],name:"general","data-key":"minidlna","error-handlers":{edit:t.handleError}},scopedSlots:t._u([{key:"default",fn:function({s:i}){return[e("tlt-tabs",{attrs:{tabs:t.tabs},scopedSlots:t._u([{key:"general",fn:function(){return[e("vuci-form-item-dummy",{attrs:{"uci-section":i,label:t.$t("MiniDLNA status"),name:"_","display-value":t.getDLNAStatus}}),e("vuci-form-item-switch",{attrs:{"uci-section":i,label:t.$t("Enable"),rmempty:!1,name:"enabled"}}),e("vuci-form-item-input",{attrs:{"uci-section":i,label:t.$t("Port"),help:t.$t("Port for HTTP (descriptions, SOAP, media transfer) traffic"),rules:"port",required:"",name:"port"}}),e("vuci-form-item-input",{attrs:{"uci-section":i,name:"friendly_name",label:t.$t("Friendly name"),help:t.$t("Set this if you want to customize the name that shows up on your clients"),rmempty:"",rules:"string",maxlength:"256",placeholder:t.$t("%s DLNA Server").format(t.$brand("companyShort"))}}),e("vuci-form-item-select",{attrs:{"uci-section":i,name:"root_container",label:t.$t("Root container"),options:t.rootContainerOpts}}),e("vuci-form-item-list",{attrs:{"uci-section":i,name:"media_dir",type:"tlt-select",label:t.$t("Media directories"),help:t.$t("Set this to the directory you want scanned. If you want to restrict the directory             to a specific content type, you can prepend the type ('A' for audio, 'V' for video, 'P' for             images), followed by a comma, to the directory (eg. A,/mnt/media/Music). Multiple directories can be specified"),"allow-create":"",options:t.mediaOptions,required:""}}),e("vuci-form-item-list",{attrs:{"uci-section":i,name:"album_art_names",label:t.$t("Album art names"),help:t.$t("This is a list of file names to check for when searching for album art"),rules:t.albumValidation,maxlength:"256",rmempty:"","allow-create":"",placeholder:t.$t("Cover.jpg")}})]},proxy:!0},{key:"advanced",fn:function(){return[e("vuci-form-item-select",{attrs:{"uci-section":i,label:t.$t("Interfaces"),help:t.$t("Network interfaces to serve"),options:t.ifaceOptions,multiple:"",name:"interface",required:i.enabled==="1"}}),e("vuci-form-item-switch",{attrs:{"uci-section":i,name:"inotify",label:t.$t("Enable inotify"),help:t.$t("Set this to enable inotify monitoring to automatically discover new files")}}),e("vuci-form-item-switch",{attrs:{"uci-section":i,name:"enable_tivo",label:t.$t("Enable TIVO"),help:t.$t("Set this to enable support for streaming .jpg and .mp3 files to a TiVo supporting HMO"),rmempty:""}}),e("vuci-form-item-switch",{attrs:{"uci-section":i,name:"strict_dlna",label:t.$t("Strict to DLNA standard"),help:t.$t("Set this to strictly adhere to DLNA standards. This will allow server-side downscaling of very large JPEG images, which may hurt JPEG serving performance on (at least) Sony DLNA products"),rmempty:""}}),e("vuci-form-item-input",{attrs:{"uci-section":i,name:"notify_interval",label:t.$t("Notify interval"),help:t.$t("Notify interval in seconds"),rules:"uinteger",placeholder:"900"}})]},proxy:!0}],null,!0)})]}}],null,!0)})]}}])})},$=[],g=u(m,p,$,!1,null,null,null,null);return g.exports});
