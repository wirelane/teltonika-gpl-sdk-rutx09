(function(r,c){typeof exports=="object"&&typeof module<"u"?module.exports=c():typeof define=="function"&&define.amd?define(c):(r=typeof globalThis<"u"?globalThis:r||self,r["services/DNP3TcpClient_js"]=c())})(this,function(){"use strict";function r(n,e,t,i,s,d,u,m){var a=typeof n=="function"?n.options:n;e&&(a.render=e,a.staticRenderFns=t,a._compiled=!0),i&&(a.functional=!0),d&&(a._scopeId="data-v-"+d);var l;if(u?(l=function(o){o=o||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!o&&typeof __VUE_SSR_CONTEXT__<"u"&&(o=__VUE_SSR_CONTEXT__),s&&s.call(this,o),o&&o._registeredComponents&&o._registeredComponents.add(u)},a._ssrRegister=l):s&&(l=m?function(){s.call(this,(a.functional?this.parent:this).$root.$options.shadowRoot)}:s),l)if(a.functional){a._injectStyles=l;var j=a.render;a.render=function(I,p){return l.call(p),j(I,p)}}else{var f=a.beforeCreate;a.beforeCreate=f?[].concat(f,l):[l]}return{exports:n,options:a}}const c={props:{section:{type:Object,required:!0},tcpClient:{type:Boolean,required:!0},formData:{type:Object,required:!0},formRef:{type:Object,default:()=>({})}},data(){return{testForm:{},testResponse:""}},computed:{requestOptions(){var n;return(n=this.formData[this.section.id])==null?void 0:n.map(e=>[e.id,e.name])},selectedTest(){var n;return((n=this.formData[this.section.id])==null?void 0:n.find(e=>e.id===this.testForm.currentTest))||{}}},methods:{async testRequest(){if(this.requestOptions.length===0){this.testResponse=this.$t("Test failed - %s").format(this.$t("There was no request to test"));return}if(!await this.formRef.validate()){this.testResponse=this.$t("Test failed - %s").format(this.$t("Some fields are invalid"));return}let n;return this.tcpClient?n={local_addr:this.section.local_addr,remote_addr:this.section.remote_addr,timeout:this.section.timeout,ip:this.section.ip,port:this.section.port,data_type:this.selectedTest.data_type,index:this.selectedTest.index,count:this.selectedTest.count}:n={local_addr:this.section.local_addr,remote_addr:this.section.remote_addr,timeout:this.section.timeout,data_type:this.selectedTest.data_type,index:this.selectedTest.index,count:this.selectedTest.count,device:this.section.device,baudrate:this.section.baudrate,databits:this.section.databits,flowcontrol:this.section.flowcontrol,parity:this.section.parity,stopbits:this.section.stopbits,time_duration:this.section.time_duration},this.$spin(this.$t("Loading")),this.$axios.post(`/api/dnp3/${this.tcpClient?"tcp":"serial"}/actions/test_request`,{data:n}).then(e=>{this.testResponse=e.data.response!=="Tests failed"?e.data.data.join(" "):this.$t("Test failed")}).catch(()=>{this.$message.error(this.$t("An unexpected error occurred"))}).finally(()=>{this.$spin(!1)})}}};var h=function(){var e=this,t=e._self._c;return t("tlt-card",{attrs:{title:e.$t("Request Configuration testing"),help:e.$t("Here you can get information about your request configurations"),model:e.testForm,sid:"testForm"}},[t("tlt-form-item-select",{attrs:{label:e.$t("Requests"),prop:"currentTest",help:e.$t("Current configurations"),options:e.requestOptions},model:{value:e.testForm.currentTest,callback:function(i){e.$set(e.testForm,"currentTest",i)},expression:"testForm.currentTest"}}),t("tlt-form-model-item",[t("tlt-button",{on:{click:function(i){return e.testRequest()}}},[e._v(" "+e._s(e.$t("Test"))+" ")])],1),t("tlt-form-item-text-area",{staticClass:"test-output",attrs:{rows:"3",prop:"testOutput",readonly:"",value:e.testResponse}})],1)},_=[],$=r(c,h,_,!1,null,"41f54ab1",null,null);const v=$.exports,y={props:{section:{type:Object,required:!0},uciData:{type:Object,required:!0},tcpClient:{type:Boolean,required:!0}},data(){return{formData:{},dataOptions:[["1",this.$t("Binary")],["3",this.$t("Double Binary")],["20",this.$t("Counter")],["21",this.$t("Frozen Counter")],["30",this.$t("Analog")],["110",this.$t("Octet String")],["40",this.$t("Analog Output Status")],["10",this.$t("Binary Output Status")]],requestColumns:[{name:"name",label:this.$t("Name"),help:this.$t("Name of the instance")},{name:"index",label:this.$t("Start Index"),help:this.$t("Start index of the data subarray")},{name:"count",label:this.$t("End Index"),help:this.$t("End index of the data subarray")},{name:"data_type",label:this.$t("Data type"),help:this.$t("Data type")},{name:"enabled",label:this.$t("Enabled")}]}},methods:{updateCountValidations(n){n.vuciSection.validate()},validateCount(n,e){const t=Number(e.uciSection.index);return isNaN(t)||t>n?{isValid:!1,message:this.$t("End of the index must be greater or equal to the start.")}:{isValid:!0}}}};var b=function(){var e=this,t=e._self._c;return t("vuci-typed-section",{attrs:{type:"instance",title:e.$t("Requests configuration"),"uci-data":e.uciData,"data-key":e.section.id,endpoints:[{endpoint:`dnp3/${e.tcpClient?"tcp":"serial"}/${e.section.id}/requests/config`}],columns:e.requestColumns},scopedSlots:e._u([{key:"name",fn:function({s:i}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":i,name:"name"}})]}},{key:"index",fn:function({s:i}){return[t("vuci-form-item-input",{attrs:{"uci-section":i,name:"index",rules:"irange(0,65535)",initial:"0",placeholder:"0",required:""},on:{change:e.updateCountValidations}})]}},{key:"count",fn:function({s:i}){return[t("vuci-form-item-input",{attrs:{"uci-section":i,name:"count",initial:"0",placeholder:"0",rules:["irange(0,65535)",e.validateCount],required:""}})]}},{key:"data_type",fn:function({s:i}){return[t("vuci-form-item-select",{attrs:{"uci-section":i,name:"data_type",options:e.dataOptions,required:""}})]}},{key:"enabled",fn:function({s:i}){return[t("vuci-form-item-switch",{attrs:{"uci-section":i,name:"enabled"}})]}},{key:"addForm",fn:function({addModel:i}){return[t("tlt-form-item-input",{attrs:{label:e.$t("New configuration name"),prop:"name",rules:"uciname",required:""},model:{value:i.name,callback:function(s){e.$set(i,"name",s)},expression:"addModel.name"}})]}}])})},C=[],g=r(y,b,C,!1,null,null,null,null);const q=g.exports,T={props:{section:{type:Object,required:!0},tcpClient:{type:Boolean,required:!0},noDevice:{type:Boolean,default:!1},initialDevice:{type:String,default:""},formData:{type:Object,required:!0},status:{type:Array,default:()=>[]},devices:{type:Array,default:()=>[]}},computed:{usedDevice(){return this.status.find(n=>n.name===this.section.device&&n.is_used==="1")}},methods:{validateAddress(n){const e=this.tcpClient&&this.formData.dnp3.some(i=>i.ip===this.section.ip&&i.port===this.section.port&&i.local_addr===n&&i.id!==this.section.id),t=!this.tcpClient&&this.formData.dnp3.some(i=>i.device===this.section.device&&i.local_addr===n&&i.id!==this.section.id);return e||t?{isValid:!1,message:this.$t("Current local address is already set in the same layer.")}:{isValid:!0}}}};var k=function(){var e=this,t=e._self._c;return t("div",[t("vuci-form-item-switch",{attrs:{"uci-section":e.section,label:e.$t("Enable"),rawhtml:"",help:e.$t("Check to enable this %s master configuration").format(e.tcpMaster?e.$t("TCP"):e.$t("Serial")),readonly:e.$serial.validateServices(e.status,e.section,"DNP3 Serial Client")&&e.section.enabled==="0",name:"enabled"}}),e.noDevice?t("tlt-inline-message",{attrs:{id:"device-not-available",type:"warning",message:e.$serial.returnDisconnectedDeviceError(e.initialDevice)}}):e._e(),e.$serial.validateServices(e.status,e.section,"DNP3 Serial Client")&&e.section.enabled==="0"?t("tlt-inline-message",{attrs:{id:"device-service-enabled",type:"warning"}},[e._v(" "+e._s(e.$t("Device is already enabled in %s service, disable it").format(e.usedDevice.service))+" "),t("router-link",{attrs:{to:e.$serial.returnPath(e.status.find(i=>i.name===e.section.device&&i.is_used==="1").service),"test-id":"device-service-enabled-link"}},[e._v(" "+e._s(e.$t("here"))+" ")])],1):e._e(),t("vuci-form-item-input",{attrs:{"uci-section":e.section,label:e.$t("Name"),help:e.$t("Name of the %s client").format(e.tcpClient?e.$t("TCP"):e.$t("Serial")),name:"name",placeholder:e.$t("Name"),maxlength:"32",required:""}}),e._t("default"),t("vuci-form-item-input",{attrs:{"uci-section":e.section,label:e.$t("Local Address"),help:e.$t("Client Link-Layer address"),name:"local_addr",placeholder:"1",rules:["irange(0,65519)",e.validateAddress],required:""}}),t("vuci-form-item-input",{attrs:{"uci-section":e.section,label:e.$t("Remote Address"),help:e.$t("Outstation Link-Layer address"),name:"remote_addr",placeholder:"10",rules:"irange(0,65519)",required:""}}),t("vuci-form-item-input",{attrs:{"uci-section":e.section,label:e.$t("Period"),help:e.$t("Period for sending data requests"),name:"integrity_period",rules:"irange(1,60)",placeholder:"60",initial:"60",required:""}}),t("vuci-form-item-input",{attrs:{"uci-section":e.section,label:e.$t("Timeout"),help:e.$t("Request timeout"),name:"timeout",placeholder:"3",rules:"irange(1,60)",required:""}}),t("vuci-form-item-switch",{attrs:{"uci-section":e.section,label:e.$t("Save to flash"),help:e.$t("Check to enable saving to flash"),name:"save_to_flash",rmempty:!1}})],2)},D=[],R=r(T,k,D,!1,null,null,null,null);const P=R.exports,x={components:{Dnp3TestingElement:v,Dnp3CommonInterfaceFields:q,Dnp3CommonEditFields:P},props:{section:{type:Object,default:()=>({})}},data(){return{tcpClient:!0}}};var F=function(){var e=this,t=e._self._c;return t("vuci-form",{ref:"form",attrs:{editing:""},scopedSlots:e._u([{key:"default",fn:function({uciData:i}){return[t("vuci-named-section",{attrs:{name:e.section.id,title:e.$t("TCP Client configuration"),"uci-data":i,"data-key":"dnp3",endpoints:[{endpoint:"dnp3/tcp/config"}]},scopedSlots:e._u([{key:"default",fn:function({s}){return[t("dnp-3-common-edit-fields",{attrs:{"form-data":i,section:s,"tcp-client":e.tcpClient}},[t("vuci-form-item-input",{attrs:{"uci-section":s,label:e.$t("IP address"),help:e.$t("DNP3 Outstation IP address"),name:"ip",placeholder:"1.1.1.1",rules:"ipaddr",required:""}}),t("vuci-form-item-input",{attrs:{"uci-section":s,label:e.$t("Port"),help:e.$t("DNP3 Outstation Port"),name:"port",placeholder:"20000",rules:"port",required:""}})],1)]}}],null,!0)}),t("dnp-3-common-interface-fields",{attrs:{"tcp-client":e.tcpClient,"uci-data":i,section:e.section}}),t("dnp-3-testing-element",{attrs:{section:e.section,"tcp-client":e.tcpClient,"form-data":i,"form-ref":e.$refs.form}})]}}])})},N=[],O=r(x,F,N,!1,null,null,null,null);const S=O.exports;var w=r({methods:{afterLoad(n,e){const t={tcp:this.$t("TCP client"),serial:this.$t("Serial client")}[e],i=n.dnp3.map(s=>`/api/dnp3/${e}/${s.id}/requests/config`);return this.$axios.bulkGet(i).then(s=>(s.forEach((d,u)=>{const m=n.dnp3[u].id;d.success?n[m]=d.data:this.$message.error(this.$t("Failed to load %s client requests for %s instance.").format(t,m))}),n)).catch(()=>{this.$message.error(this.$t("An unexpected error occurred"))})},clearRequests(n){this.formData[n.id]=[]}}},null,null,!1,null,null,null,null);const L={mixins:[w.exports],data(){return{editModal:S,formData:{},dataColumns:[{name:"name",label:this.$t("Name"),help:this.$t("Name of the client. Used for easier tunnels management purpose only")},{name:"ip",label:this.$t("IP"),help:this.$t("TCP client IP address")},{name:"port",label:this.$t("Port"),help:this.$t("Port of the TCP client")},{name:"local_addr",label:this.$t("Local Address"),help:this.$t("Client Link-Layer address")},{name:"remote_addr",label:this.$t("Remote Address"),help:this.$t("Outstation Link-Layer address")},{name:"enabled",label:this.$t("Enabled")}]}},methods:{validate(){return new Promise((n,e)=>{this.formData.dnp3.some(i=>i.enabled==="1"&&(!i.name||!i.ip||!i.port||!i.local_addr||!i.remote_addr||!i.integrity_period||!i.timeout))&&e(this.$t("Cannot enable instance when required values are missing. Navigate to edit modal to fill the missing values")),n()})}}};var A=function(){var e=this,t=e._self._c;return t("vuci-form",{attrs:{"after-load":i=>e.afterLoad(i,"tcp"),"before-save":e.validate},scopedSlots:e._u([{key:"default",fn:function({uciData:i}){return[t("vuci-typed-section",{attrs:{type:"tcp_client",title:e.$t("TCP Clients"),columns:e.dataColumns,"edit-form":e.editModal,endpoints:[{endpoint:"dnp3/tcp/config"}],"uci-data":i,"data-key":"dnp3","after-delete":e.clearRequests},scopedSlots:e._u([{key:"name",fn:function({s}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":s,name:"name"}})]}},{key:"ip",fn:function({s}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":s,name:"ip"}})]}},{key:"port",fn:function({s}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":s,name:"port"}})]}},{key:"local_addr",fn:function({s}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":s,name:"local_addr"}})]}},{key:"remote_addr",fn:function({s}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":s,name:"remote_addr"}})]}},{key:"enabled",fn:function({s}){return[t("vuci-form-item-switch",{attrs:{"uci-section":s,name:"enabled"}})]}}],null,!0)})]}}]),model:{value:e.formData,callback:function(i){e.formData=i},expression:"formData"}})},E=[],V=r(L,A,E,!1,null,null,null,null);return V.exports});
