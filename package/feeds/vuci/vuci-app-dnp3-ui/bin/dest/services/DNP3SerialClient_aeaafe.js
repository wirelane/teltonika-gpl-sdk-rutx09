(function(r,d){typeof exports=="object"&&typeof module<"u"?module.exports=d():typeof define=="function"&&define.amd?define(d):(r=typeof globalThis<"u"?globalThis:r||self,r["services/DNP3SerialClient_js"]=d())})(this,function(){"use strict";function r(s,e,t,a,i,o,u,m){var n=typeof s=="function"?s.options:s;e&&(n.render=e,n.staticRenderFns=t,n._compiled=!0),a&&(n.functional=!0),o&&(n._scopeId="data-v-"+o);var c;if(u?(c=function(l){l=l||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!l&&typeof __VUE_SSR_CONTEXT__<"u"&&(l=__VUE_SSR_CONTEXT__),i&&i.call(this,l),l&&l._registeredComponents&&l._registeredComponents.add(u)},n._ssrRegister=c):i&&(c=m?function(){i.call(this,(n.functional?this.parent:this).$root.$options.shadowRoot)}:i),c)if(n.functional){n._injectStyles=c;var V=n.render;n.render=function(j,p){return c.call(p),V(j,p)}}else{var f=n.beforeCreate;n.beforeCreate=f?[].concat(f,c):[c]}return{exports:s,options:n}}const d={props:{section:{type:Object,required:!0},tcpClient:{type:Boolean,required:!0},formData:{type:Object,required:!0},formRef:{type:Object,default:()=>({})}},data(){return{testForm:{},testResponse:""}},computed:{requestOptions(){var s;return(s=this.formData[this.section.id])==null?void 0:s.map(e=>[e.id,e.name])},selectedTest(){var s;return((s=this.formData[this.section.id])==null?void 0:s.find(e=>e.id===this.testForm.currentTest))||{}}},methods:{async testRequest(){if(this.requestOptions.length===0){this.testResponse=this.$t("Test failed - %s").format(this.$t("There was no request to test"));return}if(!await this.formRef.validate()){this.testResponse=this.$t("Test failed - %s").format(this.$t("Some fields are invalid"));return}let s;return this.tcpClient?s={local_addr:this.section.local_addr,remote_addr:this.section.remote_addr,timeout:this.section.timeout,ip:this.section.ip,port:this.section.port,data_type:this.selectedTest.data_type,index:this.selectedTest.index,count:this.selectedTest.count}:s={local_addr:this.section.local_addr,remote_addr:this.section.remote_addr,timeout:this.section.timeout,data_type:this.selectedTest.data_type,index:this.selectedTest.index,count:this.selectedTest.count,device:this.section.device,baudrate:this.section.baudrate,databits:this.section.databits,flowcontrol:this.section.flowcontrol,parity:this.section.parity,stopbits:this.section.stopbits,time_duration:this.section.time_duration},this.$spin(this.$t("Loading")),this.$axios.post(`/api/dnp3/${this.tcpClient?"tcp":"serial"}/actions/test_request`,{data:s}).then(e=>{this.testResponse=e.data.response!=="Tests failed"?e.data.data.join(" "):this.$t("Test failed")}).catch(()=>{this.$message.error(this.$t("An unexpected error occurred"))}).finally(()=>{this.$spin(!1)})}}};var h=function(){var e=this,t=e._self._c;return t("tlt-card",{attrs:{title:e.$t("Request Configuration testing"),help:e.$t("Here you can get information about your request configurations"),model:e.testForm,sid:"testForm"}},[t("tlt-form-item-select",{attrs:{label:e.$t("Requests"),prop:"currentTest",help:e.$t("Current configurations"),options:e.requestOptions},model:{value:e.testForm.currentTest,callback:function(a){e.$set(e.testForm,"currentTest",a)},expression:"testForm.currentTest"}}),t("tlt-form-model-item",[t("tlt-button",{on:{click:function(a){return e.testRequest()}}},[e._v(" "+e._s(e.$t("Test"))+" ")])],1),t("tlt-form-item-text-area",{staticClass:"test-output",attrs:{rows:"3",prop:"testOutput",readonly:"",value:e.testResponse}})],1)},v=[],$=r(d,h,v,!1,null,"41f54ab1",null,null);const _=$.exports,b={props:{section:{type:Object,required:!0},uciData:{type:Object,required:!0},tcpClient:{type:Boolean,required:!0}},data(){return{formData:{},dataOptions:[["1",this.$t("Binary")],["3",this.$t("Double Binary")],["20",this.$t("Counter")],["21",this.$t("Frozen Counter")],["30",this.$t("Analog")],["110",this.$t("Octet String")],["40",this.$t("Analog Output Status")],["10",this.$t("Binary Output Status")]],requestColumns:[{name:"name",label:this.$t("Name"),help:this.$t("Name of the instance")},{name:"index",label:this.$t("Start Index"),help:this.$t("Start index of the data subarray")},{name:"count",label:this.$t("End Index"),help:this.$t("End index of the data subarray")},{name:"data_type",label:this.$t("Data type"),help:this.$t("Data type")},{name:"enabled",label:this.$t("Enabled")}]}},methods:{updateCountValidations(s){s.vuciSection.validate()},validateCount(s,e){const t=Number(e.uciSection.index);return isNaN(t)||t>s?{isValid:!1,message:this.$t("End of the index must be greater or equal to the start.")}:{isValid:!0}}}};var y=function(){var e=this,t=e._self._c;return t("vuci-typed-section",{attrs:{type:"instance",title:e.$t("Requests configuration"),"uci-data":e.uciData,"data-key":e.section.id,endpoints:[{endpoint:`dnp3/${e.tcpClient?"tcp":"serial"}/${e.section.id}/requests/config`}],columns:e.requestColumns},scopedSlots:e._u([{key:"name",fn:function({s:a}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":a,name:"name"}})]}},{key:"index",fn:function({s:a}){return[t("vuci-form-item-input",{attrs:{"uci-section":a,name:"index",rules:"irange(0,65535)",initial:"0",placeholder:"0",required:""},on:{change:e.updateCountValidations}})]}},{key:"count",fn:function({s:a}){return[t("vuci-form-item-input",{attrs:{"uci-section":a,name:"count",initial:"0",placeholder:"0",rules:["irange(0,65535)",e.validateCount],required:""}})]}},{key:"data_type",fn:function({s:a}){return[t("vuci-form-item-select",{attrs:{"uci-section":a,name:"data_type",options:e.dataOptions,required:""}})]}},{key:"enabled",fn:function({s:a}){return[t("vuci-form-item-switch",{attrs:{"uci-section":a,name:"enabled"}})]}},{key:"addForm",fn:function({addModel:a}){return[t("tlt-form-item-input",{attrs:{label:e.$t("New configuration name"),prop:"name",rules:"uciname",required:""},model:{value:a.name,callback:function(i){e.$set(a,"name",i)},expression:"addModel.name"}})]}}])})},g=[],D=r(b,y,g,!1,null,null,null,null);const C=D.exports,O={props:{section:{type:Object,required:!0},tcpClient:{type:Boolean,required:!0},noDevice:{type:Boolean,default:!1},initialDevice:{type:String,default:""},formData:{type:Object,required:!0},status:{type:Array,default:()=>[]},devices:{type:Array,default:()=>[]}},computed:{usedDevice(){return this.status.find(s=>s.name===this.section.device&&s.is_used==="1")}},methods:{validateAddress(s){const e=this.tcpClient&&this.formData.dnp3.some(a=>a.ip===this.section.ip&&a.port===this.section.port&&a.local_addr===s&&a.id!==this.section.id),t=!this.tcpClient&&this.formData.dnp3.some(a=>a.device===this.section.device&&a.local_addr===s&&a.id!==this.section.id);return e||t?{isValid:!1,message:this.$t("Current local address is already set in the same layer.")}:{isValid:!0}}}};var q=function(){var e=this,t=e._self._c;return t("div",[t("vuci-form-item-switch",{attrs:{"uci-section":e.section,label:e.$t("Enable"),rawhtml:"",help:e.$t("Check to enable this %s master configuration").format(e.tcpMaster?e.$t("TCP"):e.$t("Serial")),readonly:e.$serial.validateServices(e.status,e.section,"DNP3 Serial Client")&&e.section.enabled==="0",name:"enabled"}}),e.noDevice?t("tlt-inline-message",{attrs:{id:"device-not-available",type:"warning",message:e.$serial.returnDisconnectedDeviceError(e.initialDevice)}}):e._e(),e.$serial.validateServices(e.status,e.section,"DNP3 Serial Client")&&e.section.enabled==="0"?t("tlt-inline-message",{attrs:{id:"device-service-enabled",type:"warning"}},[e._v(" "+e._s(e.$t("Device is already enabled in %s service, disable it").format(e.usedDevice.service))+" "),t("router-link",{attrs:{to:e.$serial.returnPath(e.status.find(a=>a.name===e.section.device&&a.is_used==="1").service),"test-id":"device-service-enabled-link"}},[e._v(" "+e._s(e.$t("here"))+" ")])],1):e._e(),t("vuci-form-item-input",{attrs:{"uci-section":e.section,label:e.$t("Name"),help:e.$t("Name of the %s client").format(e.tcpClient?e.$t("TCP"):e.$t("Serial")),name:"name",placeholder:e.$t("Name"),maxlength:"32",required:""}}),e._t("default"),t("vuci-form-item-input",{attrs:{"uci-section":e.section,label:e.$t("Local Address"),help:e.$t("Client Link-Layer address"),name:"local_addr",placeholder:"1",rules:["irange(0,65519)",e.validateAddress],required:""}}),t("vuci-form-item-input",{attrs:{"uci-section":e.section,label:e.$t("Remote Address"),help:e.$t("Outstation Link-Layer address"),name:"remote_addr",placeholder:"10",rules:"irange(0,65519)",required:""}}),t("vuci-form-item-input",{attrs:{"uci-section":e.section,label:e.$t("Period"),help:e.$t("Period for sending data requests"),name:"integrity_period",rules:"irange(1,60)",placeholder:"60",initial:"60",required:""}}),t("vuci-form-item-input",{attrs:{"uci-section":e.section,label:e.$t("Timeout"),help:e.$t("Request timeout"),name:"timeout",placeholder:"3",rules:"irange(1,60)",required:""}}),t("vuci-form-item-switch",{attrs:{"uci-section":e.section,label:e.$t("Save to flash"),help:e.$t("Check to enable saving to flash"),name:"save_to_flash",rmempty:!1}})],2)},S=[],x=r(O,q,S,!1,null,null,null,null);const k=x.exports,R={components:{Dnp3TestingElement:_,Dnp3CommonInterfaceFields:C,Dnp3CommonEditFields:k},inject:["formOptions"],props:{section:{type:Object,required:!0}},data(){return{tcpClient:!1,formData:{},initialDevice:"",requestColumns:[{name:"name",label:this.$t("Name"),help:this.$t("Name of the instance")},{name:"index",label:this.$t("Start Index"),help:this.$t("Start index of the data subarray")},{name:"count",label:this.$t("End Index"),help:this.$t("End index of the data subarray")},{name:"data_type",label:this.$t("Data type"),help:this.$t("Data type")},{name:"enabled",lable:this.$t("Enabled")}]}},computed:{device(){return this.$serial.deviceDisplayValue(this.section.device)},serialOptions(){return this.$serial.filterOptions(this.formOptions().serial,this.section.device,this.section,"external")},noDevice(){return this.$serial.checkForExternalDevice(this.formOptions().devices,{device:this.initialDevice})}},methods:{loadInitial(){this.initialDevice=this.section.device},returnErrorMessage(s){return this.$serial.handleExternalDeviceErrors(s)},validate(){return this.$serial.validateBeforeSave(this.formOptions().status,this.formData.dnp3,"DNP3 Serial Client")}}};var F=function(){var e=this,t=e._self._c;return t("vuci-form",{ref:"form",attrs:{"after-load":e.loadInitial,"before-save":e.validate,editing:""},scopedSlots:e._u([{key:"default",fn:function({uciData:a}){return[t("vuci-named-section",{attrs:{name:e.section.id,title:e.$t("Serial Client configuration"),"uci-data":a,"data-key":"dnp3",endpoints:[{endpoint:"dnp3/serial/config"}],"error-handlers":{edit:e.returnErrorMessage}},scopedSlots:e._u([{key:"default",fn:function({s:i}){return[t("dnp-3-common-edit-fields",{attrs:{"form-data":a,section:i,"tcp-client":e.tcpClient,"no-device":e.noDevice,"initial-device":e.initialDevice,devices:e.formOptions().devices,status:e.formOptions().status}},[t("vuci-form-item-select",{attrs:{"uci-section":i,label:e.$t("Serial port"),help:e.$t("Which serial port will be used for serial communication"),name:"device",options:e.formOptions().devices,required:""}}),t("vuci-form-item-select",{attrs:{"uci-section":i,label:e.$t("Baud rate"),help:e.$t("Select supported baud rate"),name:"baudrate",options:e.serialOptions.baudRate,initial:"115200"}}),t("vuci-form-item-select",{attrs:{"uci-section":i,label:e.$t("Data bits"),help:e.$t("Select how many bits will be used for character"),name:"databits",options:e.serialOptions.dataBits,initial:"8"}}),t("vuci-form-item-select",{attrs:{"uci-section":i,label:e.$t("Stop bits"),help:e.$t("Select how many stop bits will be used to detect the end of character"),name:"stopbits",options:e.serialOptions.stopBits,initial:"1"}}),t("vuci-form-item-select",{attrs:{"uci-section":i,label:e.$t("Parity"),help:e.$t("Select what kind of parity bit to use for error detection"),name:"parity",options:e.serialOptions.parity,initial:"none"}}),t("vuci-form-item-select",{attrs:{"uci-section":i,label:e.$t("Flow control"),help:e.$t("Select what kind of characters to use for flow control"),name:"flowcontrol",options:e.serialOptions.flowControl,initial:"none"}}),t("vuci-form-item-switch",{attrs:{"uci-section":i,label:e.$t("Full Duplex"),help:e.$t("Check to enable %s Full-Duplex").format(e.device),name:"full_duplex_enabled",depend:i.device==="/dev/rs485"}}),t("vuci-form-item-input",{attrs:{"uci-section":i,label:e.$t("Open Delay"),help:e.$t("Some physical layers need time to 'settle' so that the first tx isn't lost"),name:"time_duration",placeholder:"1",rules:"irange(1,10000)",required:""}})],1)]}}],null,!0)}),t("dnp-3-common-interface-fields",{attrs:{"tcp-client":e.tcpClient,"uci-data":a,section:e.section}}),t("dnp-3-testing-element",{attrs:{section:e.section,"tcp-client":e.tcpClient,"form-data":a,"form-ref":e.$refs.form}})]}}]),model:{value:e.formData,callback:function(a){e.formData=a},expression:"formData"}})},w=[],N=r(R,F,w,!1,null,null,null,null);const T=N.exports;var E=r({methods:{afterLoad(s,e){const t={tcp:this.$t("TCP client"),serial:this.$t("Serial client")}[e],a=s.dnp3.map(i=>`/api/dnp3/${e}/${i.id}/requests/config`);return this.$axios.bulkGet(a).then(i=>(i.forEach((o,u)=>{const m=s.dnp3[u].id;o.success?s[m]=o.data:this.$message.error(this.$t("Failed to load %s client requests for %s instance.").format(t,m))}),s)).catch(()=>{this.$message.error(this.$t("An unexpected error occurred"))})},clearRequests(s){this.formData[s.id]=[]}}},null,null,!1,null,null,null,null);const P={mixins:[E.exports],provide(){return{formOptions:this.getFormOptions}},data(){return{editModal:T,dataColumns:[{name:"name",label:this.$t("Name"),help:this.$t("Name of the client. Used for easier tunnels management purpose only")},{name:"local_addr",label:this.$t("Local Address"),help:this.$t("Client Link-Layer address")},{name:"remote_addr",label:this.$t("Remote Address"),help:this.$t("Outstation Link-Layer address")},{name:"enabled",label:this.$t("Enabled")}],formOptions:{serial:[],status:[],devices:[]},formData:{}}},computed:{devices(){return this.$serial.filterDevices(this.formOptions.serial)}},methods:{noDevice(s){return!this.devices.some(e=>e.includes(s.device))},getFormOptions(){return this.formOptions},returnErrorMessage(s){return this.$serial.handleExternalDeviceErrors(s)},loadData(s){return this.$axios.bulkGet(["/api/serial/status","/api/system/device/status"]).then(([e,t])=>{this.formOptions.status=e.success?e.data:[],this.formOptions.serial=t.success&&t.data.board.serial?t.data.board.serial:[],this.formOptions.devices=this.devices,t.success||this.$message.error(this.$t("Failed to load serial data")),e.success||this.$message.error(this.$t("Failed to load serial status"))}).catch(()=>{this.$message.error(this.$t("An unexpected error occurred"))}).then(()=>this.afterLoad(s,"serial"))},validate(){return new Promise((s,e)=>{const t=this.$serial.validateBeforeSave(this.formOptions.status,this.formData.dnp3,"DNP3 Serial Client",!1);this.formData.dnp3.some(i=>i.enabled==="1"&&(!i.time_duration||!i.local_addr||!i.remote_addr||!i.integrity_period||!i.timeout))&&e(this.$t("Cannot enable instance when required values are missing. Navigate to edit modal to fill the missing values")),t.isValid||e(t.message),s()})}}};var A=function(){var e=this,t=e._self._c;return t("vuci-form",{attrs:{"after-load":e.loadData,"before-save":e.validate},scopedSlots:e._u([{key:"default",fn:function({uciData:a}){return[t("vuci-typed-section",{attrs:{type:"serial_client",title:e.$t("Serial Clients"),columns:e.dataColumns,"edit-form":e.editModal,endpoints:[{endpoint:"dnp3/serial/config"}],"uci-data":a,"data-key":"dnp3","error-handlers":{edit:e.returnErrorMessage},"after-delete":e.clearRequests},scopedSlots:e._u([{key:"name",fn:function({s:i}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":i,name:"name"}})]}},{key:"local_addr",fn:function({s:i}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":i,name:"local_addr"}})]}},{key:"remote_addr",fn:function({s:i}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":i,name:"remote_addr"}})]}},{key:"enabled",fn:function({s:i}){return[t("tlt-hint",{attrs:{rawhtml:"",hints:(e.$serial.validateServices(e.formOptions.status,i,"DNP3 Serial Client")||e.noDevice(i))&&(i.enabled==="0"||!i.enabled)?[{info:e.$serial.filterError(e.formOptions.status,i,e.devices)}]:[]}},[t("vuci-form-item-switch",{attrs:{"uci-section":i,name:"enabled",readonly:(e.$serial.validateServices(e.formOptions.status,i,"DNP3 Serial Client")||e.noDevice(i))&&(i.enabled==="0"||!i.enabled)}})],1)]}},{key:"addForm",fn:function({addModel:i}){return[t("tlt-form-item-input",{attrs:{label:e.$t("New configuration name"),prop:"name",maxlength:"32",help:e.$t("Name of the DNP3 serial client configuration")},model:{value:i.name,callback:function(o){e.$set(i,"name",o)},expression:"addModel.name"}}),t("tlt-form-item-select",{attrs:{label:e.$t("Serial port"),prop:"device",options:e.devices,placeholder:e.$t("Serial device is unavailable"),help:e.$t("Device that is bound to the created section. Routers serial ports or USB port with a serial adapter attached can be used.")},model:{value:i.device,callback:function(o){e.$set(i,"device",o)},expression:"addModel.device"}})]}}],null,!0)})]}}]),model:{value:e.formData,callback:function(a){e.formData=a},expression:"formData"}})},B=[],L=r(P,A,B,!1,null,null,null,null);return L.exports});
