(function(l,d){typeof exports=="object"&&typeof module<"u"?module.exports=d():typeof define=="function"&&define.amd?define(d):(l=typeof globalThis<"u"?globalThis:l||self,l["services/Tinc_js"]=d())})(this,function(){"use strict";function l(s,e,t,o,n,i,u,f){var a=typeof s=="function"?s.options:s;e&&(a.render=e,a.staticRenderFns=t,a._compiled=!0),o&&(a.functional=!0),i&&(a._scopeId="data-v-"+i);var c;if(u?(c=function(r){r=r||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!r&&typeof __VUE_SSR_CONTEXT__<"u"&&(r=__VUE_SSR_CONTEXT__),n&&n.call(this,r),r&&r._registeredComponents&&r._registeredComponents.add(u)},a._ssrRegister=c):n&&(c=f?function(){n.call(this,(a.functional?this.parent:this).$root.$options.shadowRoot)}:n),c)if(a.functional){a._injectStyles=c;var C=a.render;a.render=function(M,p){return c.call(p),C(M,p)}}else{var m=a.beforeCreate;a.beforeCreate=m?[].concat(m,c):[c]}return{exports:s,options:a}}const d={props:{section:{type:Object,required:!0}},data(){return{parent:this.section.net}},methods:{validateSubnet(s){this.$VuciValidator.value=s;const e=this.$VuciValidator.ipmask(),t=this.$VuciValidator.macaddr();return e.isValid||t.isValid?{isValid:!0}:{isValid:!1,message:this.$t("One of the following: IPv4, IPv6 or MAC addresses are accepted. E.g 192.168.1.0/24, 00:1a:2b:3c:4b:5c")}}}};var h=function(){var e=this,t=e._self._c;return t("vuci-form",{attrs:{editing:"",config:"tinc"},scopedSlots:e._u([{key:"default",fn:function({uciData:o}){return[t("vuci-named-section",{attrs:{endpoints:[{endpoint:`tinc/${e.parent}/hosts/config`}],name:e.section.id,title:e.$t("Tinc host %s").format(e.section.id),"uci-data":o,"data-key":"tinc_hosts"},scopedSlots:e._u([{key:"default",fn:function({s:n}){return[t("vuci-form-item-switch",{attrs:{"uci-section":n,label:e.$t("Enable"),help:e.$t("Turn this tinc interface on/off"),name:"enabled",initial:"0"}}),t("vuci-form-item-input",{attrs:{"uci-section":n,label:e.$t("Description"),help:e.$t("Optional. Description of host."),name:"description",placeholder:e.$t("My Host"),rules:"string"}}),t("vuci-form-item-list",{attrs:{"uci-section":n,name:"address",label:e.$t("Address"),help:e.$t("It must resolve to the external IP address where the host can be reached, not the one that is internal to the VPN."),rules:"host",placeholder:"192.168.1.120"}}),t("vuci-form-item-list",{attrs:{"uci-section":n,name:"subnet",label:e.$t("Subnet"),help:e.$t("The subnet which this tinc daemon will serve. Multiple subnet lines can be specified for each Daemon"),rules:e.validateSubnet,placeholder:"0.0.0.0/0"}}),t("vuci-form-item-upload",{attrs:{"uci-section":n,name:"publickeyfile",label:e.$t("Public Key"),help:e.$t("Generated RSA public key"),"max-size":"16MB"}})]}}],null,!0)})]}}])})},v=[],$=l(d,h,v,!1,null,null,null,null);const b=$.exports,_={inject:["formOptions"],props:{section:{type:Object,required:!0}},data(){return{editModal:b,tabs:[{tab:"general",title:this.$t("General Setup")},{tab:"advanced",title:this.$t("Advanced Settings")}],hostColumns:[{name:"id",label:this.$t("Host name")},{name:"description",label:this.$t("Description")},{name:"enabled"}],formData:{},familyOptions:[["any","Any"],["ipv4","IPv4"],["ipv6","IPv6"]],modeOptions:[["router","Router"],["switch","Switch"],["hub","Hub"]]}},computed:{interfaceData(){return this.formOptions().interfaceData},hostOptions(){return this.formData.tinc_hosts.filter(s=>s.net===this.section.id).map(s=>[s.id,s.id])},tunnelOptions(){const e=this.interfaceData.map(t=>{const o=this.$network.getName(t);return t.proto==="wwan"||t.proto==="connm"?[o,o.toUpperCase()]:[o,o.toUpperCase()+" ("+t.ifname+")"]});return e.unshift(["",this.$t("Any")]),e}},methods:{validateHostName(s,e){let t={isValid:!0};return this.formData.tinc_hosts.some(n=>n.id===s)&&(t={isValid:!1,message:this.$t("Tinc host with same name already exists.")}),t},validateSubnet(s){this.$VuciValidator.value=s;const e=this.$VuciValidator.ipmask(),t=this.$VuciValidator.macaddr();return e.isValid||t.isValid?{isValid:!0}:{isValid:!1,message:this.$t("One of the following: IPv4, IPv6 or MAC addresses are accepted. E.g 192.168.1.0/24, 00:1a:2b:3c:4b:5c")}}}};var y=function(){var e=this,t=e._self._c;return t("vuci-form",{attrs:{config:"tinc",editing:""},scopedSlots:e._u([{key:"default",fn:function({uciData:o,editableSection:n}){return[t("vuci-named-section",{attrs:{endpoints:[{endpoint:"tinc/config"}],name:n.id,title:e.$t("Tinc Interface: %s").format(e.section.id),"uci-data":o,"data-key":"tinc"},scopedSlots:e._u([{key:"default",fn:function({s:i}){return[t("tlt-tabs",{attrs:{tabs:e.tabs},scopedSlots:e._u([{key:"general",fn:function(){return[t("vuci-form-item-switch",{attrs:{"uci-section":i,label:e.$t("Enable"),help:e.$t("Turn this tinc interface on/off"),name:"enabled",initial:"0"}}),t("vuci-form-item-list",{attrs:{"uci-section":i,name:"subnet",label:e.$t("Subnet"),help:e.$t("The subnet which this tinc daemon will serve. Multiple subnet lines can be specified for each Daemon"),rules:e.validateSubnet,placeholder:"0.0.0.0/0"}}),t("vuci-form-item-upload",{attrs:{"uci-section":i,name:"privatekeyfile",label:e.$t("Private Key"),help:e.$t("Generated RSA private key"),"max-size":"16MB"}}),t("vuci-form-item-upload",{attrs:{"uci-section":i,name:"publickeyfile",label:e.$t("Public Key"),help:e.$t("Generated RSA public key"),"max-size":"16MB"}}),t("vuci-form-item-select",{attrs:{"uci-section":i,name:"connectto",label:e.$t("Host to Connect to"),help:e.$t("Specifies which other tinc daemon to connect to on startup. Multiple variables may be specified, in which case outgoing connections to each specified tinc daemon are made"),options:e.hostOptions,multiple:""}})]},proxy:!0},{key:"advanced",fn:function(){return[t("vuci-form-item-select",{attrs:{"uci-section":i,label:e.$t("Address Family"),help:e.$t("This option affects the address family of listening and outgoing sockets"),options:e.familyOptions,name:"addressfamily"}}),t("vuci-form-item-list",{attrs:{"uci-section":i,name:"bindtoaddress",label:e.$t("Bind To Address"),help:e.$t("Addresses for Tinc VPN to use for listening sockets."),rules:"ipaddr",placeholder:"0.0.0.0"}}),t("vuci-form-item-select",{attrs:{"uci-section":i,name:"bindtointerface",label:e.$t("Bind To Interface"),options:e.tunnelOptions,help:e.$t("Interface to listen for incoming connections.")}}),t("vuci-form-item-input",{attrs:{"uci-section":i,name:"keyexpire",label:e.$t("Key Expire"),rules:"irange(1, 90000000)",help:e.$t("This option controls the time the encryption keys used to encrypt the data are Valid.")}}),t("vuci-form-item-select",{attrs:{"uci-section":i,label:e.$t("Mode"),help:e.$t("This option selects the way packets are routed to other daemons."),options:e.modeOptions,name:"mode"}}),t("vuci-form-item-input",{attrs:{"uci-section":i,name:"pinginterval",label:e.$t("Ping Interval"),rules:"irange(1, 86400)",help:e.$t("The number of seconds of inactivity that tinc will wait before sending a probe to the other end.")}}),t("vuci-form-item-input",{attrs:{"uci-section":i,name:"pingtimeout",label:e.$t("Ping Timeout"),rules:"irange(1, 86400)",help:e.$t("The number of seconds to wait for a response to pings or to allow meta connections to block. If the other end doesn't respond within this time, the connection is terminated, and the others will be notified of this.")}})]},proxy:!0}],null,!0)})]}}],null,!0)}),t("vuci-typed-section",{attrs:{type:"tinc-host_"+e.section.id,endpoints:[{endpoint:`tinc/${e.section.id}/hosts/config`}],"uci-data":o,title:e.$t("Hosts"),help:e.$t("Here you can add your VPN hosts"),columns:e.hostColumns,"edit-form":e.editModal,"data-key":"tinc_hosts"},scopedSlots:e._u([{key:"id",fn:function({s:i}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":i,name:"id"}})]}},{key:"description",fn:function({s:i}){return[t("vuci-form-item-dummy",{attrs:{"uci-section":i,name:"description"}})]}},{key:"enabled",fn:function({s:i}){return[t("vuci-form-item-switch",{attrs:{"uci-section":i,name:"enabled"}})]}},{key:"addForm",fn:function({addModel:i}){return[t("tlt-form-item-input",{attrs:{label:e.$t("Add new instance"),prop:"id",required:"",rules:["uciname",e.validateHostName],maxlength:"8"},model:{value:i.id,callback:function(u){e.$set(i,"id",u)},expression:"addModel.id"}})]}}],null,!0)})]}}]),model:{value:e.formData,callback:function(o){e.formData=o},expression:"formData"}})},g=[],k=l(_,y,g,!1,null,null,null,null);const w=k.exports,T={provide(){return{formOptions:this.getFormOptions}},data(){return{editModal:w,deviceColumns:[{name:"id",label:this.$t("Tunnel name"),help:this.$t("Name of the tunnel. Used for easier tunnels management purpose only")},{name:"enabled"}],formOptions:{interfaceData:[]}}},methods:{getFormOptions(){return this.formOptions},loadHosts(s){const t=["/api/interfaces/config",...s.tinc.map(o=>`/api/tinc/${o.id}/hosts/config`)];return this.$axios.bulkGet(t).then(o=>{const n=o.shift();n.success?this.formOptions={interfaceData:n.data}:this.$message.error(this.$t("Failed to load network interfaces"));const i=o.some(f=>f.success===!1),u=i?[]:o.flatMap(f=>f.data);return i&&this.$message.error(this.$t("Failed to load Tinc hosts.")),{tinc_hosts:u}}).catch(()=>{this.$message.error(this.$t("An unexpected error occurred"))})},deleteHosts(s,e){e.tinc_hosts=e.tinc_hosts.filter(t=>t[".type"]!==`tinc-host_${s.id}`)}}};var V=function(){var e=this,t=e._self._c;return t("vuci-form",{attrs:{config:"tinc","after-load":e.loadHosts},scopedSlots:e._u([{key:"default",fn:function({uciData:o}){return[t("vuci-typed-section",{attrs:{title:e.$t("Tinc Configuration"),columns:e.deviceColumns,type:"tinc-net","uci-data":o,"edit-form":e.editModal,endpoints:[{endpoint:"tinc/config"}],"data-key":"tinc","after-delete":e.deleteHosts},scopedSlots:e._u([{key:"id",fn:function({s:n}){return[t("vuci-form-item-dummy",{attrs:{name:"id","uci-section":n}})]}},{key:"enabled",fn:function({s:n}){return[t("vuci-form-item-switch",{attrs:{name:"enabled","uci-section":n}})]}},{key:"addForm",fn:function({addModel:n}){return[t("tlt-form-item-input",{attrs:{label:e.$t("New configuration name"),prop:"id",required:"",maxlength:"8",rules:"uciname"},model:{value:n.id,callback:function(i){e.$set(n,"id",i)},expression:"addModel.id"}})]}}],null,!0)})]}}])})},O=[],S=l(T,V,O,!1,null,null,null,null);return S.exports});
