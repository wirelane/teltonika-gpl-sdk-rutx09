Index: hostapd-2020-06-08-5a8b3662/wpa_supplicant/wpa_supplicant.c
===================================================================
--- hostapd-2020-06-08-5a8b3662.orig/wpa_supplicant/wpa_supplicant.c
+++ hostapd-2020-06-08-5a8b3662/wpa_supplicant/wpa_supplicant.c
@@ -142,15 +142,43 @@ static int hostapd_stop(struct wpa_suppl
 	return 0;
 }
 
+static int parse_chanwidth(enum chan_width chanwidth)
+{
+	switch (chanwidth) {
+	case CHAN_WIDTH_80:
+		return CHANWIDTH_80MHZ;
+	case CHAN_WIDTH_80P80:
+		return CHANWIDTH_80P80MHZ;
+	case CHAN_WIDTH_160:
+		return CHANWIDTH_160MHZ;
+	case CHAN_WIDTH_2160:
+		return CHAN_WIDTH_2160;
+	case CHAN_WIDTH_4320:
+		return CHANWIDTH_4320MHZ;
+	case CHAN_WIDTH_6480:
+		return CHANWIDTH_6480MHZ;
+	case CHAN_WIDTH_8640:
+		return CHANWIDTH_8640MHZ;
+	default:
+		break;
+	}
+
+	return CHANWIDTH_USE_HT;
+}
+
 int hostapd_reload(struct wpa_supplicant *wpa_s, struct wpa_bss *bss, int no_params)
 {
+	const u8 *ie;
 	char *cmd = NULL;
 	char buf[256];
 	size_t len = sizeof(buf);
 	enum hostapd_hw_mode hw_mode;
-	u8 channel;
-	int sec_chan = 0;
-	int ret;
+	u8 channel = 0, center_frq1_chan = 0, center_frq2_chan = 0, op_class = 0;
+	int ret, vht = 0;
+	struct wpa_channel_info ci = { 0 };
+	struct ieee80211_ht_operation *ht_oper	 = NULL;
+	struct ieee80211_vht_operation *vht_oper = NULL;
+	u8 seg0, seg1;
 
 	if (no_params) {
 		if (asprintf(&cmd, "UPDATE NO_PARAMS") < 0)
@@ -161,17 +189,55 @@ int hostapd_reload(struct wpa_supplicant
 	if (!bss)
 		return -1;
 
-	if (bss->ht_param & HT_INFO_HT_PARAM_STA_CHNL_WIDTH) {
-		int sec = bss->ht_param & HT_INFO_HT_PARAM_SECONDARY_CHNL_OFF_MASK;
-		if (sec == HT_INFO_HT_PARAM_SECONDARY_CHNL_ABOVE)
-			sec_chan = 1;
-		else if (sec ==  HT_INFO_HT_PARAM_SECONDARY_CHNL_BELOW)
-			sec_chan = -1;
+	hw_mode = ieee80211_freq_to_chan(bss->freq, &channel);
+
+	if (wpa_drv_channel_info(wpa_s, &ci)) {
+		return -1;
 	}
 
-	hw_mode = ieee80211_freq_to_chan(bss->freq, &channel);
-	if (asprintf(&cmd, "UPDATE channel=%d sec_chan=%d hw_mode=%d",
-		     channel, sec_chan, hw_mode) < 0)
+	if (ci.center_frq1 < bss->freq)
+		ci.sec_channel = -1;
+	if (ci.center_frq1 > bss->freq)
+		ci.sec_channel = 1;
+
+	ie = wpa_bss_get_ie(bss, WLAN_EID_VHT_OPERATION);
+	if (ie && ie[1] >= sizeof(struct ieee80211_vht_operation)) {
+		vht_oper = (struct ieee80211_vht_operation *)(ie + 2);
+
+		switch (vht_oper->vht_op_info_chwidth) {
+		case 1:
+			seg0 = vht_oper->vht_op_info_chan_center_freq_seg0_idx;
+			seg1 = vht_oper->vht_op_info_chan_center_freq_seg1_idx;
+			if (seg1 && abs(seg1 - seg0) == 8)
+				vht = CHANWIDTH_160MHZ;
+			else if (seg1)
+				vht = CHANWIDTH_80P80MHZ;
+			else
+				vht = CHANWIDTH_80MHZ;
+			break;
+		case 2:
+			vht = CHANWIDTH_160MHZ;
+			break;
+		case 3:
+			vht = CHANWIDTH_80P80MHZ;
+			break;
+		default:
+			vht = parse_chanwidth(ci.chanwidth);
+			break;
+		}
+	}
+
+	if (ci.center_frq1)
+		ieee80211_freq_to_channel_ext(ci.center_frq1, ci.sec_channel, vht, &op_class,
+					      &center_frq1_chan);
+	if (ci.center_frq2 && vht > CHANWIDTH_80MHZ)
+		ieee80211_freq_to_channel_ext(ci.center_frq2, ci.sec_channel, vht, &op_class,
+					      &center_frq2_chan);
+
+	if (asprintf(
+		    &cmd,
+		    "UPDATE channel=%d sec_chan=%d hw_mode=%d center_frq1=%d center_frq2=%d vht_oper_chwidth=%d",
+		    channel, ci.sec_channel, hw_mode, center_frq1_chan, vht > CHANWIDTH_80MHZ ? center_frq2_chan : 0, vht) < 0)
 		return -1;
 
 reload_no_params:
Index: hostapd-2020-06-08-5a8b3662/hostapd/ctrl_iface.c
===================================================================
--- hostapd-2020-06-08-5a8b3662.orig/hostapd/ctrl_iface.c
+++ hostapd-2020-06-08-5a8b3662/hostapd/ctrl_iface.c
@@ -152,10 +152,7 @@ static struct hostapd_config *hostapd_ct
 	if (!conf)
 		return NULL;
 
-	for (opt = strtok(reload_opts, " ");
-	     opt;
-		 opt = strtok(NULL, " ")) {
-
+	for (opt = strtok(reload_opts, " "); opt; opt = strtok(NULL, " ")) {
 		if ((val = get_option(opt, "channel=")))
 			conf->channel = atoi(val);
 		else if ((val = get_option(opt, "ht_capab=")))
@@ -168,10 +165,23 @@ static struct hostapd_config *hostapd_ct
 			conf->hw_mode = atoi(val);
 		else if ((val = get_option(opt, "ieee80211n=")))
 			conf->ieee80211n = atoi(val);
-		else
+		else if ((val = get_option(opt, "vht_oper_chwidth=")))
+			conf->vht_oper_chwidth = atoi(val);
+		else if ((val = get_option(opt, "center_frq1="))) {
+			conf->vht_oper_centr_freq_seg0_idx = strtol(val, NULL, 10);
+		} else if ((val = get_option(opt, "center_frq2="))) {
+			conf->vht_oper_centr_freq_seg1_idx = strtol(val, NULL, 10);
+		} else
 			break;
 	}
 
+	wpa_printf(
+		MSG_DEBUG,
+		"channel: %d | ht_capab: %d | sec_chan: %d |hw_mode: %d | ieee80211n: %d | vht_oper_chwidth: %d | center_frq1: %d | center_frq2: %d\n",
+		conf->channel, conf->ht_capab, conf->secondary_channel, conf->hw_mode, conf->ieee80211n,
+		conf->vht_oper_chwidth, conf->vht_oper_centr_freq_seg0_idx,
+		conf->vht_oper_centr_freq_seg1_idx);
+
 	return conf;
 }
 
